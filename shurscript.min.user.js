// Shur Scripts SA
// GPLv2 Licensed
// http://www.gnu.org/licenses/gpl-2.0.html
//
// ==UserScript==
// @name            ShurScript
// @description     Script para ForoCoches
// @namespace       http://shurscript.es
// @version         0.21.0.2-exp
// @author          TheBronx
// @author          xusO
// @author          Fritanga / Korrosivo
// @author          Juno / ikaros45
// @author          Electrosa
// @include         http://www.forocoches.com*
// @include         http://forocoches.com*
// @grant           GM_log
// @grant           GM_getValue
// @grant           GM_setValue
// @grant           GM_deleteValue
// @grant           GM_xmlhttpRequest
// @grant           GM_registerMenuCommand
// @grant           GM_addStyle
// @grant           GM_getResourceText
// @grant           GM_getResourceURL
// @grant           GM_getMetadata
// @run-at          document-end
// @resource        bootstrapcss https://github.com/TheBronx/shurscript/raw/experimental/css/bootstrap.css
// @resource        modalcss https://github.com/TheBronx/shurscript/raw/experimental/css/modal.css
// @resource        shurbarcss https://github.com/TheBronx/shurscript/raw/experimental/css/shurbar.css
// @resource        modalhtml https://github.com/TheBronx/shurscript/raw/experimental/html/modal.html
// @resource        quotehtml https://github.com/TheBronx/shurscript/raw/experimental/html/quote.html
// @resource        imageuploadercss https://github.com/TheBronx/shurscript/raw/experimental/css/imageuploader.css
// @resource        imageuploaderhtml https://github.com/TheBronx/shurscript/raw/experimental/html/imageuploader.html
// @resource        autoiconscss https://github.com/TheBronx/shurscript/raw/experimental/css/autoicons.css
// ==/UserScript==
function getCurrentPage(){var e;return(e=decodeURIComponent((RegExp("[?|&]page=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1]))?e:(e=document.getElementById("showthread_threadrate_form"))?e.page.value:(e=document.querySelector(".pagenav:first-child span strong"))?e.textContent:null}function getCurrentThread(){var e;return(e=unsafeWindow.threadid)?e:(e=decodeURIComponent((RegExp("[?|&]t=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1]))?e:(e=document.getElementById("qr_threadid"))?e.t.value:null}window.bootbox=window.bootbox||function init(e,t){"use strict";function n(e){return m[h.locale][e]||m.en[e]}function a(t,n,a){t.preventDefault();var o=e.isFunction(a)&&a(t)===!1;o||n.modal("hide")}function o(e){var t,n=0;for(t in e)n++;return n}function i(t,n){var a=0;e.each(t,function(e,t){n(e,t,a++)})}function r(t){var n,a;if("object"!=typeof t)throw Error("Please supply an object of options");if(!t.message)throw Error("Please specify a message");return t=e.extend({},h,t),t.buttons||(t.buttons={}),t.backdrop=t.backdrop?"static":!1,n=t.buttons,a=o(n),i(n,function(e,t,n){if(!t.label)throw Error("button with key "+e+" requires a label");t.className||(t.className=2>=a&&n===a-1?"btn-primary":"btn-default")}),t}function s(e,t){var n=e.length,a={};if(1>n||n>2)throw Error("Invalid argument length");return 2===n||"string"==typeof e[0]?(a[t[0]]=e[0],a[t[1]]=e[1]):a=e[0],a}function l(t,n,a){return e.extend(!0,{},t,s(n,a))}function c(){for(var e={},t=0,a=arguments.length;a>t;t++){var o=arguments[t],i=o.toLowerCase(),r=o.toUpperCase();e[i]={label:n(r)}}return e}function d(){return{buttons:c.apply(null,arguments)}}var p={dialog:"<div class='bootbox modal' tabindex='-1' role='dialog'><div class='modal-dialog'><div class='modal-content'><div class='modal-body'><div class='bootbox-body'></div></div></div></div></div>",header:"<div class='modal-header'><h4 class='modal-title'></h4></div>",footer:"<div class='modal-footer'></div>",closeButton:"<button type='button' class='bootbox-close-button close'>&times;</button>",form:"<form class='bootbox-form'></form>",inputs:{text:"<input class='bootbox-input form-control' autocomplete=off type=text />"}},u=e("body"),h={locale:"en",backdrop:!0,animate:!0,className:null,closeButton:!0,show:!0},f={};f.alert=function(){var t;if(t=l(d("ok"),arguments,["message","callback"]),t.callback&&!e.isFunction(t.callback))throw Error("alert requires callback property to be a function when provided");return t.buttons.ok.callback=t.onEscape=function(){return e.isFunction(t.callback)?t.callback():!0},f.dialog(t)},f.confirm=function(){var t;if(t=l(d("cancel","confirm"),arguments,["message","callback"]),t.buttons.cancel.callback=t.onEscape=function(){return t.callback(!1)},t.buttons.confirm.callback=function(){return t.callback(!0)},!e.isFunction(t.callback))throw Error("confirm requires a callback");return f.dialog(t)},f.prompt=function(){var n,a,o,i,r,s;if(i=e(p.form),a={buttons:c("cancel","confirm"),value:""},n=l(a,arguments,["title","callback"]),s=n.show===t?!0:n.show,n.message=i,n.buttons.cancel.callback=n.onEscape=function(){return n.callback(null)},n.buttons.confirm.callback=function(){return n.callback(r.val())},n.show=!1,!n.title)throw Error("prompt requires a title");if(!e.isFunction(n.callback))throw Error("prompt requires a callback");return r=e(p.inputs.text),r.val(n.value),i.append(r),i.on("submit",function(e){e.preventDefault(),o.find(".btn-primary").click()}),o=f.dialog(n),o.off("shown.bs.modal"),o.on("shown.bs.modal",function(){r.focus()}),s===!0&&o.modal("show"),o},f.dialog=function(t){t=r(t);var n=e(p.dialog),o=n.find(".modal-body"),s=t.buttons,l="",c={onEscape:t.onEscape};if(i(s,function(e,t){l+="<button data-bb-handler='"+e+"' type='button' class='btn "+t.className+"'>"+t.label+"</button>",c[e]=t.callback}),o.find(".bootbox-body").html(t.message),t.animate===!0&&n.addClass("fade"),t.className&&n.addClass(t.className),t.title&&o.before(p.header),t.closeButton){var d=e(p.closeButton);t.title?n.find(".modal-header").prepend(d):d.css("margin-top","-10px").prependTo(o)}return t.title&&n.find(".modal-title").html(t.title),l.length&&(o.after(p.footer),n.find(".modal-footer").html(l)),n.on("hidden.bs.modal",function(e){e.target===this&&n.remove()}),n.on("shown.bs.modal",function(){n.find(".btn-primary:first").focus()}),n.on("escape.close.bb",function(e){c.onEscape&&a(e,n,c.onEscape)}),n.on("click",".modal-footer button",function(t){var o=e(this).data("bb-handler");a(t,n,c[o])}),n.on("click",".bootbox-close-button",function(e){a(e,n,c.onEscape)}),n.on("keyup",function(e){27===e.which&&n.trigger("escape.close.bb")}),u.append(n),n.modal({backdrop:t.backdrop,keyboard:!1,show:!1}),t.show&&n.modal("show"),n},f.setDefaults=function(t){e.extend(h,t)},f.hideAll=function(){e(".bootbox").modal("hide")};var m={br:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Sim"},da:{OK:"OK",CANCEL:"Annuller",CONFIRM:"Accepter"},de:{OK:"OK",CANCEL:"Abbrechen",CONFIRM:"Akzeptieren"},en:{OK:"OK",CANCEL:"Cancel",CONFIRM:"OK"},es:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Aceptar"},fi:{OK:"OK",CANCEL:"Peruuta",CONFIRM:"OK"},fr:{OK:"OK",CANCEL:"Annuler",CONFIRM:"D'accord"},it:{OK:"OK",CANCEL:"Annulla",CONFIRM:"Conferma"},nl:{OK:"OK",CANCEL:"Annuleren",CONFIRM:"Accepteren"},pl:{OK:"OK",CANCEL:"Anuluj",CONFIRM:"Potwierdź"},ru:{OK:"OK",CANCEL:"Отмена",CONFIRM:"Применить"},zh_CN:{OK:"OK",CANCEL:"取消",CONFIRM:"确认"},zh_TW:{OK:"OK",CANCEL:"取消",CONFIRM:"確認"}};return f.init=function(t){window.bootbox=init(t||e)},f}(window.jQuery);var Markdown;Markdown="object"==typeof exports&&"function"==typeof require?exports:{},function(){function e(e){return e}function t(){return!1}function n(){}function a(){}n.prototype={chain:function(t,n){var a=this[t];if(!a)throw Error("unknown hook "+t);this[t]=a===e?n:function(){var e=Array.prototype.slice.call(arguments,0);return e[0]=a.apply(null,e),n.apply(null,e)}},set:function(e,t){if(!this[e])throw Error("unknown hook "+e);this[e]=t},addNoop:function(t){this[t]=e},addFalse:function(e){this[e]=t}},Markdown.HookCollection=n,a.prototype={set:function(e,t){this["s_"+e]=t},get:function(e){return this["s_"+e]}},Markdown.Converter=function(){function e(e){return e=e.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(e,t,n,a,o,i){return t=t.toLowerCase(),N.set(t,_(n)),o?a:(i&&$.set(t,i.replace(/"/g,"&quot;")),"")})}function t(e){return e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,o),e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,o),e=e.replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,o),e=e.replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,o),e=e.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,o)}function o(e,t){var n=t;return n=n.replace(/^\n+/,""),n=n.replace(/\n+$/g,""),n="\n\n~K"+(L.push(n)-1)+"K\n\n"}function i(e,n){e=P.preBlockGamut(e,H),e=h(e);var a="<hr />\n";return e=e.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,a),e=e.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,a),e=e.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,a),e=f(e),e=g(e),e=x(e),e=P.postBlockGamut(e,H),e=t(e),e=k(e,n)}function r(e){return e=P.preSpanGamut(e),e=b(e),e=s(e),e=T(e),e=d(e),e=l(e),e=S(e),e=e.replace(/~P/g,"://"),e=_(e),e=w(e),e=e.replace(/  +\n/g," <br>\n"),e=P.postSpanGamut(e)}function s(e){var t=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi;return e=e.replace(t,function(e){var t=e.replace(/(.)<\/?code>(?=.)/g,"$1`");return t=A(t,"!"==e.charAt(1)?"\\`*_/":"\\`*_")})}function l(e){return e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,c),e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()\s])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,c),e=e.replace(/(\[([^\[\]]+)\])()()()()()/g,c)}function c(e,t,n,a,o,i,r,s){void 0==s&&(s="");var l=t,c=n.replace(/:\/\//g,"~P"),d=a.toLowerCase(),u=o,h=s;if(""==u)if(""==d&&(d=c.toLowerCase().replace(/ ?\n/g," ")),u="#"+d,void 0!=N.get(d))u=N.get(d),void 0!=$.get(d)&&(h=$.get(d));else{if(!(l.search(/\(\s*\)$/m)>-1))return l;u=""}u=M(u),u=A(u,"*_");var f='<a href="'+u+'"';return""!=h&&(h=p(h),h=A(h,"*_"),f+=' title="'+h+'"'),f+=">"+c+"</a>"}function d(e){return e=e.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,u),e=e.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,u)}function p(e){return e.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function u(e,t,n,a,o,i,r,s){var l=t,c=n,d=a.toLowerCase(),u=o,h=s;if(h||(h=""),""==u){if(""==d&&(d=c.toLowerCase().replace(/ ?\n/g," ")),u="#"+d,void 0==N.get(d))return l;u=N.get(d),void 0!=$.get(d)&&(h=$.get(d))}c=A(p(c),"*_[]()"),u=A(u,"*_");var f='<img src="'+u+'" alt="'+c+'"';return h=p(h),h=A(h,"*_"),f+=' title="'+h+'"',f+=" />"}function h(e){return e=e.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(e,t){return"<h1>"+r(t)+"</h1>\n\n"}),e=e.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(e,t){return"<h2>"+r(t)+"</h2>\n\n"}),e=e.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(e,t,n){var a=t.length;return"<h"+a+">"+r(n)+"</h"+a+">\n\n"})}function f(e,t){e+="~0";var n=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return D?e=e.replace(n,function(e,n,a){var o=n,i=a.search(/[*+-]/g)>-1?"ul":"ol",r=m(o,i,t);return r=r.replace(/\s+$/,""),r="<"+i+">"+r+"</"+i+">\n"}):(n=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,e=e.replace(n,function(e,t,n,a){var o=t,i=n,r=a.search(/[*+-]/g)>-1?"ul":"ol",s=m(i,r);return s=o+"<"+r+">\n"+s+"</"+r+">\n"})),e=e.replace(/~0/,"")}function m(e,t,n){D++,e=e.replace(/\n{2,}$/,"\n"),e+="~0";var a=U[t],o=RegExp("(^[ \\t]*)("+a+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+a+")[ \\t]+))","gm"),s=!1;return e=e.replace(o,function(e,t,a,o){var l=o,c=/\n\n$/.test(l),d=c||l.search(/\n{2,}/)>-1;return d||s?l=i(R(l),!0):(l=f(R(l),!0),l=l.replace(/\n$/,""),n||(l=r(l))),s=c,"<li>"+l+"</li>\n"}),e=e.replace(/~0/g,""),D--,e}function g(e){return e+="~0",e=e.replace(/(?:\n\n|^\n?)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(e,t,n){var a=t,o=n;return a=y(R(a)),a=O(a),a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,""),a="<pre><code>"+a+"\n</code></pre>","\n\n"+a+"\n\n"+o}),e=e.replace(/~0/,"")}function v(e){return e=e.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(L.push(e)-1)+"K\n\n"}function b(e){return e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(e,t,n,a){var o=a;return o=o.replace(/^([ \t]*)/g,""),o=o.replace(/[ \t]*$/g,""),o=y(o),o=o.replace(/:\/\//g,"~P"),t+"<code>"+o+"</code>"})}function y(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=A(e,"*_{}[]\\",!1)}function w(e){return e=e.replace(/([\W_]|^)(\*\*|__)(?=\S)([^\r]*?\S[\*_]*)\2([\W_]|$)/g,"$1<strong>$3</strong>$4"),e=e.replace(/([\W_]|^)(\*|_)(?=\S)([^\r\*_]*?\S)\2([\W_]|$)/g,"$1<em>$3</em>$4")}function x(e){return e=e.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(e,t){var n=t;return n=n.replace(/^[ \t]*>[ \t]?/gm,"~0"),n=n.replace(/~0/g,""),n=n.replace(/^[ \t]+$/gm,""),n=i(n),n=n.replace(/(^|\n)/g,"$1  "),n=n.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,t){var n=t;return n=n.replace(/^  /gm,"~0"),n=n.replace(/~0/g,"")}),v("<blockquote>\n"+n+"\n</blockquote>")})}function k(e,t){e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,"");for(var n=e.split(/\n{2,}/g),a=[],o=/~K(\d+)K/,i=n.length,s=0;i>s;s++){var l=n[s];o.test(l)?a.push(l):/\S/.test(l)&&(l=r(l),l=l.replace(/^([ \t]*)/g,"<p>"),l+="</p>",a.push(l))}if(!t){i=a.length;for(var s=0;i>s;s++)for(var c=!0;c;)c=!1,a[s]=a[s].replace(/~K(\d+)K/g,function(e,t){return c=!0,L[t]})}return a.join("\n\n")}function _(e){return e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),e=e.replace(/<(?![a-z\/?!]|~D)/gi,"&lt;")}function T(e){return e=e.replace(/\\(\\)/g,I),e=e.replace(/\\([`*_{}\[\]()>#+-.!])/g,I)}function C(e,t,n,a){if(t)return e;if(")"!==a.charAt(a.length-1))return"<"+n+a+">";for(var o=a.match(/[()]/g),i=0,r=0;o.length>r;r++)"("===o[r]?0>=i?i=1:i++:i--;var s="";if(0>i){var l=RegExp("\\){1,"+-i+"}$");a=a.replace(l,function(e){return s=e,""})}if(s){var c=a.charAt(a.length-1);F.test(c)||(s=c+s,a=a.substr(0,a.length-1))}return"<"+n+a+">"+s}function S(e){e=e.replace(q,C);var t=function(e,t){return'<a href="'+t+'">'+P.plainLinkText(t)+"</a>"};return e=e.replace(/<((https?|ftp):[^'">\s]+)>/gi,t)}function E(e){return e=e.replace(/~E(\d+)E/g,function(e,t){var n=parseInt(t);return String.fromCharCode(n)})}function R(e){return e=e.replace(/^(\t|[ ]{1,4})/gm,"~0"),e=e.replace(/~0/g,"")}function O(e){if(!/\t/.test(e))return e;var t,n=["    ","   ","  "," "],a=0;return e.replace(/[\n\t]/g,function(e,o){return"\n"===e?(a=o+1,e):(t=(o-a)%4,a=o+1,n[t])})}function M(e){if(!e)return"";var t=e.length;return e.replace(V,function(n,a){return"~D"==n?"%24":":"!=n||a!=t-1&&!/[0-9\/]/.test(e.charAt(a+1))?"%"+n.charCodeAt(0).toString(16):":"})}function A(e,t,n){var a="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";n&&(a="\\\\"+a);var o=RegExp(a,"g");return e=e.replace(o,I)}function I(e,t){var n=t.charCodeAt(0);return"~E"+n+"E"}var P=this.hooks=new n;P.addNoop("plainLinkText"),P.addNoop("preConversion"),P.addNoop("postNormalization"),P.addNoop("preBlockGamut"),P.addNoop("postBlockGamut"),P.addNoop("preSpanGamut"),P.addNoop("postSpanGamut"),P.addNoop("postConversion");var N,$,L,D;this.makeHtml=function(n){if(N)throw Error("Recursive call to converter.makeHtml");return N=new a,$=new a,L=[],D=0,n=P.preConversion(n),n=n.replace(/~/g,"~T"),n=n.replace(/\$/g,"~D"),n=n.replace(/\r\n/g,"\n"),n=n.replace(/\r/g,"\n"),n="\n\n"+n+"\n\n",n=O(n),n=n.replace(/^[ \t]+$/gm,""),n=P.postNormalization(n),n=t(n),n=e(n),n=i(n),n=E(n),n=n.replace(/~D/g,"$$"),n=n.replace(/~T/g,"~"),n=P.postConversion(n),L=$=N=null,n};var H=function(e){return i(e)},U={ol:"\\d+[.]",ul:"[*+-]"},B="[-A-Z0-9+&@#/%?=~_|[\\]()!:,.;]",K="[-A-Z0-9+&@#/%=~_|[\\])]",q=RegExp('(="|<)?\\b(https?|ftp)(://'+B+"*"+K+")(?=$|\\W)","gi"),F=RegExp(K,"i"),V=/(?:["'*()[\]:]|~D)/g}}(),!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=global.window&&global.window.$?e(global.window.$):function(t){if(!t.$&&!t.fn)throw Error("Tokenfield requires a window object with jQuery or a jQuery instance");return e(t.$||t)}:e(jQuery)}(function(e,t){"use strict";var n=function(n,a){var o=this;this.$element=e(n),this.textDirection=this.$element.css("direction"),this.options=e.extend(!0,{},e.fn.tokenfield.defaults,{tokens:this.$element.val()},this.$element.data(),a),this._delimiters="string"==typeof this.options.delimiter?[this.options.delimiter]:this.options.delimiter,this._triggerKeys=e.map(this._delimiters,function(e){return e.charCodeAt(0)}),this._firstDelimiter=this._delimiters[0];var i=e.inArray(" ",this._delimiters),r=e.inArray("-",this._delimiters);i>=0&&(this._delimiters[i]="\\s"),r>=0&&(delete this._delimiters[r],this._delimiters.unshift("-"));var s=["\\","$","[","{","^",".","|","?","*","+","(",")"];e.each(this._delimiters,function(t,n){var a=e.inArray(n,s);a>=0&&(o._delimiters[t]="\\"+n)});var l,c=t&&"function"==typeof t.getMatchedCSSRules?t.getMatchedCSSRules(n):null,d=n.style.width,p=this.$element.width();c&&e.each(c,function(e,t){t.style.width&&(l=t.style.width)});var u="rtl"===e("body").css("direction")?"right":"left",h={position:this.$element.css("position")};h[u]=this.$element.css(u),this.$element.data("original-styles",h).data("original-tabindex",this.$element.prop("tabindex")).css("position","absolute").css(u,"-10000px").prop("tabindex",-1),this.$wrapper=e('<div class="tokenfield form-control" />'),this.$element.hasClass("input-lg")&&this.$wrapper.addClass("input-lg"),this.$element.hasClass("input-sm")&&this.$wrapper.addClass("input-sm"),"rtl"===this.textDirection&&this.$wrapper.addClass("rtl");var f=this.$element.prop("id")||(new Date).getTime()+""+Math.floor(100*(1+Math.random()));this.$input=e('<input type="text" class="token-input" autocomplete="off" />').appendTo(this.$wrapper).prop("placeholder",this.$element.prop("placeholder")).prop("id",f+"-tokenfield").prop("tabindex",this.$element.data("original-tabindex"));var m=e('label[for="'+this.$element.prop("id")+'"]');if(m.length&&m.prop("for",this.$input.prop("id")),this.$copyHelper=e('<input type="text" />').css("position","absolute").css(u,"-10000px").prop("tabindex",-1).prependTo(this.$wrapper),d?this.$wrapper.css("width",d):l?this.$wrapper.css("width",l):this.$element.parents(".form-inline").length&&this.$wrapper.width(p),(this.$element.prop("disabled")||this.$element.parents("fieldset[disabled]").length)&&this.disable(),this.$mirror=e('<span style="position:absolute; top:-999px; left:0; white-space:pre;"/>'),this.$input.css("min-width",this.options.minWidth+"px"),e.each(["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],function(e,t){o.$mirror[0].style[t]=o.$input.css(t)}),this.$mirror.appendTo("body"),this.$wrapper.insertBefore(this.$element),this.$element.prependTo(this.$wrapper),this.update(),this.setTokens(this.options.tokens,!1,!1),this.listen(),!e.isEmptyObject(this.options.autocomplete)){var g="rtl"===this.textDirection?"right":"left",v=e.extend({minLength:this.options.showAutocompleteOnFocus?0:null,position:{my:g+" top",at:g+" bottom",of:this.$wrapper}},this.options.autocomplete);this.$input.autocomplete(v)}if(!e.isEmptyObject(this.options.typeahead)){var b=e.extend({minLength:this.options.showAutocompleteOnFocus?0:null},this.options.typeahead);this.$input.typeahead(null,b),this.typeahead=!0}this.$element.trigger("tokenfield:initialize")};n.prototype={constructor:n,createToken:function(t,n){"string"==typeof t&&(t={value:t,label:t}),n===void 0&&(n=!0);var a=this,o=e.trim(t.value),i=t.label&&t.label.length?e.trim(t.label):o;if(!(!o.length||!i.length||this.options.minLength>o.length||this.options.limit&&this.getTokens().length>=this.options.limit)){var r=e.Event("tokenfield:preparetoken");if(r.token={value:o,label:i},this.$element.trigger(r),r.token){if(o=r.token.value,i=r.token.label,!this.options.allowDuplicates&&e.grep(this.getTokens(),function(e){return e.value===o}).length){var s=e.Event("tokenfield:preventduplicate");s.token={value:o,label:i},this.$element.trigger(s);var l=this.$wrapper.find('.token[data-value="'+o+'"]').addClass("duplicate");return setTimeout(function(){l.removeClass("duplicate")},250),!1}var c=e('<div class="token" />').attr("data-value",o).append('<span class="token-label" />').append('<a href="#" class="close" tabindex="-1">&times;</a>');this.$input.hasClass("tt-input")?this.$input.parent().before(c):this.$input.before(c),this.$input.css("width",this.options.minWidth+"px");var d=c.find(".token-label"),p=c.find(".close");this.maxTokenWidth||(this.maxTokenWidth=this.$wrapper.width()-p.outerWidth()-parseInt(p.css("margin-left"),10)-parseInt(p.css("margin-right"),10)-parseInt(c.css("border-left-width"),10)-parseInt(c.css("border-right-width"),10)-parseInt(c.css("padding-left"),10)-parseInt(c.css("padding-right"),10),parseInt(d.css("border-left-width"),10)-parseInt(d.css("border-right-width"),10)-parseInt(d.css("padding-left"),10)-parseInt(d.css("padding-right"),10),parseInt(d.css("margin-left"),10)-parseInt(d.css("margin-right"),10)),d.text(i).css("max-width",this.maxTokenWidth),c.on("mousedown",function(){return a.disabled?!1:(a.preventDeactivation=!0,void 0)}).on("click",function(e){return a.disabled?!1:(a.preventDeactivation=!1,e.ctrlKey||e.metaKey?(e.preventDefault(),a.toggle(c)):(a.activate(c,e.shiftKey,e.shiftKey),void 0))}).on("dblclick",function(){return a.disabled||!a.options.allowEditing?!1:(a.edit(c),void 0)}),p.on("click",e.proxy(this.remove,this));var u=e.Event("tokenfield:createtoken");u.token=r.token,u.relatedTarget=c.get(0),this.$element.trigger(u);var h=e.Event("change");return h.initiator="tokenfield",n&&this.$element.val(this.getTokensList()).trigger(h),this.update(),this.$input.get(0)}}},setTokens:function(t,n,a){if(t){n||this.$wrapper.find(".token").remove(),a===void 0&&(a=!0),"string"==typeof t&&(t=this._delimiters.length?t.split(RegExp("["+this._delimiters.join("")+"]")):[t]);var o=this;return e.each(t,function(e,t){o.createToken(t,a)}),this.$element.get(0)}},getTokenData:function(t){var n=t.map(function(){var t=e(this);return{value:t.attr("data-value"),label:t.find(".token-label").text()}}).get();return 1==n.length&&(n=n[0]),n},getTokens:function(t){var n=this,a=[],o=t?".active":"";return this.$wrapper.find(".token"+o).each(function(){a.push(n.getTokenData(e(this)))}),a},getTokensList:function(t,n,a){t=t||this._firstDelimiter,n=n!==void 0&&null!==n?n:this.options.beautify;var o=t+(n&&" "!==t?" ":"");return e.map(this.getTokens(a),function(e){return e.value}).join(o)},getInput:function(){return this.$input.val()},listen:function(){var n=this;this.$element.on("change",e.proxy(this.change,this)),this.$wrapper.on("mousedown",e.proxy(this.focusInput,this)),this.$input.on("focus",e.proxy(this.focus,this)).on("blur",e.proxy(this.blur,this)).on("paste",e.proxy(this.paste,this)).on("keydown",e.proxy(this.keydown,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this)),this.$copyHelper.on("focus",e.proxy(this.focus,this)).on("blur",e.proxy(this.blur,this)).on("keydown",e.proxy(this.keydown,this)).on("keyup",e.proxy(this.keyup,this)),this.$input.on("keypress",e.proxy(this.update,this)).on("keyup",e.proxy(this.update,this)),this.$input.on("autocompletecreate",function(){var t=e(this).data("ui-autocomplete").menu.element,a=n.$wrapper.outerWidth()-parseInt(t.css("border-left-width"),10)-parseInt(t.css("border-right-width"),10);t.css("min-width",a+"px")}).on("autocompleteselect",function(e,t){return n.createToken(t.item)&&(n.$input.val(""),n.$input.data("edit")&&n.unedit(!0)),!1}).on("typeahead:selected",function(e,t){n.createToken(t)&&(n.$input.typeahead("val",""),n.$input.data("edit")&&n.unedit(!0))}).on("typeahead:autocompleted",function(){n.createToken(n.$input.val()),n.$input.typeahead("val",""),n.$input.data("edit")&&n.unedit(!0)}),e(t).on("resize",e.proxy(this.update,this))},keydown:function(t){function n(e){if(o.$input.is(document.activeElement)){if(o.$input.val().length>0)return;e+="All";var n=o.$input.hasClass("tt-input")?o.$input.parent()[e](".token:first"):o.$input[e](".token:first");if(!n.length)return;o.preventInputFocus=!0,o.preventDeactivation=!0,o.activate(n),t.preventDefault()}else o[e](t.shiftKey),t.preventDefault()}function a(n){if(t.shiftKey){if(o.$input.is(document.activeElement)){if(o.$input.val().length>0)return;var a=o.$input.hasClass("tt-input")?o.$input.parent()[n+"All"](".token:first"):o.$input[n+"All"](".token:first");if(!a.length)return;o.activate(a)}var i="prev"===n?"next":"prev",r="prev"===n?"first":"last";o.firstActiveToken[i+"All"](".token").each(function(){o.deactivate(e(this))}),o.activate(o.$wrapper.find(".token:"+r),!0,!0),t.preventDefault()}}if(this.focused){var o=this;switch(t.keyCode){case 8:if(!this.$input.is(document.activeElement))break;this.lastInputValue=this.$input.val();break;case 37:n("rtl"===this.textDirection?"next":"prev");break;case 38:a("prev");break;case 39:n("rtl"===this.textDirection?"prev":"next");break;case 40:a("next");break;case 65:if(this.$input.val().length>0||!t.ctrlKey&&!t.metaKey)break;this.activateAll(),t.preventDefault();break;case 9:case 13:if(this.$input.data("ui-autocomplete")&&this.$input.data("ui-autocomplete").menu.element.find("li:has(a.ui-state-focus)").length)break;if(this.$input.hasClass("tt-input")&&this.$wrapper.find(".tt-cursor").length)break;if(this.$input.hasClass("tt-input")&&this.$wrapper.find(".tt-hint").val().length)break;if(this.$input.is(document.activeElement)&&this.$input.val().length||this.$input.data("edit"))return this.createTokensFromInput(t,this.$input.data("edit"));if(13===t.keyCode){if(!this.$copyHelper.is(document.activeElement)||1!==this.$wrapper.find(".token.active").length)break;if(!o.options.allowEditing)break;this.edit(this.$wrapper.find(".token.active"))}}this.lastKeyDown=t.keyCode}},keypress:function(t){return this.lastKeyPressCode=t.keyCode,this.lastKeyPressCharCode=t.charCode,-1!==e.inArray(t.charCode,this._triggerKeys)&&this.$input.is(document.activeElement)?(this.$input.val()&&this.createTokensFromInput(t),!1):void 0},keyup:function(e){if(this.preventInputFocus=!1,this.focused){switch(e.keyCode){case 8:if(this.$input.is(document.activeElement)){if(this.$input.val().length||this.lastInputValue.length&&8===this.lastKeyDown)break;this.preventDeactivation=!0;var t=this.$input.hasClass("tt-input")?this.$input.parent().prevAll(".token:first"):this.$input.prevAll(".token:first");if(!t.length)break;this.activate(t)}else this.remove(e);break;case 46:this.remove(e,"next")}this.lastKeyUp=e.keyCode}},focus:function(){this.focused=!0,this.$wrapper.addClass("focus"),this.$input.is(document.activeElement)&&(this.$wrapper.find(".active").removeClass("active"),this.firstActiveToken=null,this.options.showAutocompleteOnFocus&&this.search())},blur:function(e){this.focused=!1,this.$wrapper.removeClass("focus"),this.preventDeactivation||this.$element.is(document.activeElement)||(this.$wrapper.find(".active").removeClass("active"),this.firstActiveToken=null),!this.preventCreateTokens&&(this.$input.data("edit")&&!this.$input.is(document.activeElement)||this.options.createTokensOnBlur)&&this.createTokensFromInput(e),this.preventDeactivation=!1,this.preventCreateTokens=!1},paste:function(e){var t=this;setTimeout(function(){t.createTokensFromInput(e)},1)},change:function(e){"tokenfield"!==e.initiator&&this.setTokens(this.$element.val())},createTokensFromInput:function(e,t){if(!(this.options.minLength>this.$input.val().length)){var n=this.getTokensList();return this.setTokens(this.$input.val(),!0),n==this.getTokensList()&&this.$input.val().length?!1:(this.$input.hasClass("tt-input")?this.$input.typeahead("val",""):this.$input.val(""),this.$input.data("edit")&&this.unedit(t),!1)}},next:function(e){if(e){var t=this.$wrapper.find(".active:first"),n=t&&this.firstActiveToken?this.firstActiveToken.index()>t.index():!1;if(n)return this.deactivate(t)}var a=this.$wrapper.find(".active:last"),o=a.nextAll(".token:first");return o.length?(this.activate(o,e),void 0):(this.$input.focus(),void 0)},prev:function(e){if(e){var t=this.$wrapper.find(".active:last"),n=t&&this.firstActiveToken?t.index()>this.firstActiveToken.index():!1;if(n)return this.deactivate(t)}var a=this.$wrapper.find(".active:first"),o=a.prevAll(".token:first");return o.length||(o=this.$wrapper.find(".token:first")),o.length||e?(this.activate(o,e),void 0):(this.$input.focus(),void 0)},activate:function(t,n,a,o){if(t&&this.$wrapper.find(".token.active").length!==this.$wrapper.find(".token").length){if(o===void 0)var o=!0;if(a)var n=!0;if(this.$copyHelper.focus(),n||(this.$wrapper.find(".active").removeClass("active"),o?this.firstActiveToken=t:delete this.firstActiveToken),a&&this.firstActiveToken){var i=this.firstActiveToken.index()-2,r=t.index()-2,s=this;this.$wrapper.find(".token").slice(Math.min(i,r)+1,Math.max(i,r)).each(function(){s.activate(e(this),!0)})}t.addClass("active"),this.$copyHelper.val(this.getTokensList(null,null,!0)).select()}},activateAll:function(){var t=this;this.$wrapper.find(".token").each(function(n){t.activate(e(this),0!==n,!1,!1)})},deactivate:function(e){e&&(e.removeClass("active"),this.$copyHelper.val(this.getTokensList(null,null,!0)).select())},toggle:function(e){e&&(e.toggleClass("active"),this.$copyHelper.val(this.getTokensList(null,null,!0)).select())},edit:function(t){if(t){var n=t.data("value"),a=t.find(".token-label").text(),o=e.Event("tokenfield:edittoken");if(o.token={value:n,label:a},o.relatedTarget=t.get(0),this.$element.trigger(o),o.token){n=o.token.value,a=o.token.label,t.find(".token-label").text(n);var i=t.outerWidth(),r=this.$input.hasClass("tt-input")?this.$input.parent():this.$input;t.replaceWith(r),this.preventCreateTokens=!0,this.$input.val(n).select().data("edit",!0).width(i),this.update()}}},unedit:function(e){var t=this.$input.hasClass("tt-input")?this.$input.parent():this.$input;if(t.appendTo(this.$wrapper),this.$input.data("edit",!1),this.$mirror.text(""),this.update(),e){var n=this;setTimeout(function(){n.$input.focus()},1)}},remove:function(t,n){if(!this.$input.is(document.activeElement)&&!this.disabled){var a="click"===t.type?e(t.target).closest(".token"):this.$wrapper.find(".token.active");if("click"!==t.type){if(!n)var n="prev";if(this[n](),"prev"===n)var o=0===a.first().prevAll(".token:first").length}var i=e.Event("tokenfield:removetoken");i.token=this.getTokenData(a);var r=e.Event("change");r.initiator="tokenfield",a.remove(),this.$element.val(this.getTokensList()).trigger(i).trigger(r),(!this.$wrapper.find(".token").length||"click"===t.type||o)&&this.$input.focus(),this.$input.css("width",this.options.minWidth+"px"),this.update(),t.preventDefault(),t.stopPropagation()}},update:function(){var e=this.$input.val(),t=parseInt(this.$input.css("padding-left"),10),n=parseInt(this.$input.css("padding-right"),10),a=t+n;if(this.$input.data("edit")){if(e||(e=this.$input.prop("placeholder")),e===this.$mirror.text())return;this.$mirror.text(e);var o=this.$mirror.width()+10;if(o>this.$wrapper.width())return this.$input.width(this.$wrapper.width());this.$input.width(o)}else{if(this.$input.css("width",this.options.minWidth+"px"),"rtl"===this.textDirection)return this.$input.width(this.$input.offset().left+this.$input.outerWidth()-this.$wrapper.offset().left-parseInt(this.$wrapper.css("padding-left"),10)-a-1);this.$input.width(this.$wrapper.offset().left+this.$wrapper.width()+parseInt(this.$wrapper.css("padding-left"),10)-this.$input.offset().left-a)}},focusInput:function(t){if(!e(t.target).closest(".token").length&&!e(t.target).closest(".token-input").length){var n=this;setTimeout(function(){n.$input.focus()},0)}},search:function(){this.$input.data("ui-autocomplete")&&this.$input.autocomplete("search")},disable:function(){this.disabled=!0,this.$input.prop("disabled",!0),this.$element.prop("disabled",!0),this.$wrapper.addClass("disabled")},enable:function(){this.disabled=!1,this.$input.prop("disabled",!1),this.$element.prop("disabled",!1),this.$wrapper.removeClass("disabled")},destroy:function(){this.$element.val(this.getTokensList()),this.$element.css(this.$element.data("original-styles")),this.$element.prop("tabindex",this.$element.data("original-tabindex"));var t=e('label[for="'+this.$input.prop("id")+'"]');t.length&&t.prop("for",this.$element.prop("id")),this.$element.insertBefore(this.$wrapper),this.$element.removeData("original-styles"),this.$element.removeData("original-tabindex"),this.$element.removeData("bs.tokenfield"),this.$wrapper.remove();var n=this.$element;return delete this,n}};var a=e.fn.tokenfield;return e.fn.tokenfield=function(t,a){var o,i=[];Array.prototype.push.apply(i,arguments);var r=this.each(function(){var r=e(this),s=r.data("bs.tokenfield"),l="object"==typeof t&&t;"string"==typeof t&&s&&s[t]?(i.shift(),o=s[t].apply(s,i)):s||"string"==typeof t||a||r.data("bs.tokenfield",s=new n(this,l))});return o!==void 0?o:r},e.fn.tokenfield.defaults={minWidth:60,minLength:0,allowDuplicates:!1,allowEditing:!0,limit:0,autocomplete:{},typeahead:{},showAutocompleteOnFocus:!1,createTokensOnBlur:!1,delimiter:",",beautify:!0},e.fn.tokenfield.Constructor=n,e.fn.tokenfield.noConflict=function(){return e.fn.tokenfield=a,this},n}),function(e,t,n){e.ichecked||(e.ichecked=function(){n=e.jQuery||e.Zepto;var a={autoInit:!0,autoAjax:!0,tap:!0,checkboxClass:"icheckbox",radioClass:"iradio",checkedClass:"checked",disabledClass:"disabled",indeterminateClass:"indeterminate",hoverClass:"hover",callbacks:{ifCreated:!1},classes:{base:"icheck",div:"#-item",area:"#-area-",input:"#-input",label:"#-label"}};
e.icheck=n.extend(a,e.icheck);var o=e.navigator.userAgent,i=/MSIE [5-8]/.test(o)||9>t.documentMode,r=/Opera Mini/.test(o),s=a.classes.base,l=a.classes.div.replace("#",s),c=a.classes.area.replace("#",s),d=a.classes.input.replace("#",s),p=a.classes.label.replace("#",s);delete a.classes;var u,h,f={},m={},g=RegExp(s+"\\[(.*?)\\]"),v=function(e,t,n){return e&&(t=g.exec(e))&&m[t[1]]&&(n=t[1]),n},b=e.getComputedStyle,y=e.PointerEvent||e.MSPointerEvent,w="ontouchend"in e,x=/mobile|tablet|phone|ip(ad|od)|android|silk|webos/i.test(o),o=["mouse","down","up","over","out"],k=e.PointerEvent?["pointer",o[1],o[2],o[3],o[4]]:["MSPointer","Down","Up","Over","Out"],_=["touch","start","end"],T=w&&x||y,C=T?w?_[0]+_[1]:k[0]+k[3]:o[0]+o[3],S=T?w?_[0]+_[2]:k[0]+k[4]:o[0]+o[4],E=T?w?!1:k[0]+k[1]:o[0]+o[1],R=T?w?!1:k[0]+k[2]:o[0]+o[2],o=r?"":C+".i "+S+".i ",k=!r&&E?E+".i "+R+".i":"",O=!1!==a.areaStyle?'position:absolute;display:block;content:"";top:#;bottom:#;left:#;right:#;':0,M=function(n,a,o){u||(u=t.createElement("style"),(t.head||t.getElementsByTagName("head")[0]).appendChild(u),e.createPopup||u.appendChild(t.createTextNode("")),h=u.sheet||u.styleSheet),a||(a="div."+(o?c+o+":after":l+" input."+d)),n=n.replace(/!/g," !important"),h.addRule?h.addRule(a,n,0):h.insertRule(a+"{"+n+"}",0)};M("position:absolute!;display:block!;outline:none!;"+(a.debug?"":"opacity:0!;z-index:-99!;clip:rect(0 0 0 0)!;")),(w&&x||r)&&M("cursor:pointer!;","label."+p+",div."+l),M("display:none!","iframe.icheck-frame");var A=function(e,t,n,a,o,i,r){return(a=e.className)?(o=" "+a+" ",1===n?i=t:0===n?r=t:(i=t[0],r=t[1]),i&&0>o.indexOf(" "+i+" ")&&(o+=i+" "),r&&~o.indexOf(" "+r+" ")&&(o=o.replace(" "+r+" "," ")),o=o.replace(/^\s+|\s+$/g,""),o!==a&&(e.className=o),o):void 0},I=function(e,t,a,o,i,r){m[t]&&(o=m[t],i=o.className,r=n(N(e,"div",i)),r.length&&(n(e).removeClass(d+" "+i).attr("style",o.style),n("label."+o.esc).removeClass(p+" "+i),n(r).replaceWith(n(e)),a&&$(e,t,a)),m[t]=!1)},P=function(e,t,a,o,i){for(a=[],o=e.length;o--;)if(t=e[o],t.type)~"input[type=checkbox],input[type=radio]".indexOf(t.type)&&a.push(t);else for(t=n(t).find("input[type=checkbox],input[type=radio]"),i=t.length;i--;)a.push(t[i]);return a},N=function(e,t,n,a){for(;9!==e.nodeType;)if(e=e.parentNode,e.tagName==t.toUpperCase()&&~e.className.indexOf(n)){a=e;break}return a},$=function(e,t,a){a="if"+a,!1!==m[t].callbacks&&("function"==typeof m[t].callbacks[a]&&m[t].callbacks[a](e,m[t]),!1!==m[t].callbacks[a]&&n(e).trigger(a))},L=function(o,i,r,u){o=P(o);for(var h=o.length;h--;){var g,y,w,x,k,_,T=o[h],C=T.attributes,S={},E=C.length,R={},L={},H=T.id,U=T.className,B=T.type,K=n.cache?n.cache[T[n.expando]]:0,q=v(U),F="",V=!1;_=[];for(var G=e.FastClick?" needsclick":"";E--;)g=C[E].name,y=C[E].value,~g.indexOf("data-")&&(R[g.substr(5)]=y),"style"==g&&(x=y),S[g]=y;K&&K.data&&(R=n.extend(R,K.data));for(w in R)y=R[w],("true"==y||"false"==y)&&(y="true"==y),L[w.replace(/checkbox|radio|class|id|label/g,function(e,t){return 0===t?e:e.charAt(0).toUpperCase()+e.slice(1)})]=y;if(C=n.extend({},a,e.icheck,L,i),E=C.handle,"checkbox"!==E&&"radio"!==E&&(E="input[type=checkbox],input[type=radio]"),!1!==C.init&&~E.indexOf(B)){for(q&&I(T,q);!m[q];)if(q=Math.random().toString(36).substr(2,5),!m[q]){k=s+"["+q+"]";break}if(delete C.autoInit,delete C.autoAjax,C.style=x||"",C.className=k,C.esc=k.replace(/(\[|\])/g,"\\$1"),m[q]=C,(E=N(T,"label",""))&&(!E.htmlFor&&H&&(E.htmlFor=H),_.push(E)),H)for(g=n('label[for="'+H+'"]');g.length--;)H=g[g.length],H!==E&&_.push(H);for(y=_.length;y--;)H=_[y],g=H.className,g=(E=v(g))?A(H,s+"["+E+"]",0):(g?g+" ":"")+p,H.className=g+" "+k+G;if(_=t.createElement("div"),C.inherit)for(H=C.inherit.split(/\s*,\s*/),g=H.length;g--;)E=H[g],void 0!==S[E]&&("class"==E?F+=S[E]+" ":_.setAttribute(E,"id"==E?s+"-"+S[E]:S[E]));F+=C[B+"Class"],F+=" "+l+" "+k,C.area&&O&&(V=0|(""+C.area).replace(/%|px|em|\+|-/g,""))&&(f[V]||(M(O.replace(/#/g,"-"+V+"%"),!1,V),f[V]=!0),F+=" "+c+V),_.className=F+G,T.className=(U?U+" ":"")+d+" "+k,T.parentNode.replaceChild(_,T),_.appendChild(T),C.insert&&n(_).append(C.insert),V&&(S=b?b(_,null).getPropertyValue("position"):_.currentStyle.position,"static"==S&&(_.style.position="relative")),D(T,_,q,"updated",!0,!1,r),m[q].done=!0,u||$(T,q,"Created")}}},D=function(e,t,n,a,o,i,r){var s=m[n],l={},c={};l.checked=[e.checked,"Checked","Unchecked"],i&&!r||"click"===a||(l.disabled=[e.disabled,"Disabled","Enabled"],l.indeterminate=["true"==e.getAttribute("indeterminate")||!!e.indeterminate,"Indeterminate","Determinate"]),"updated"==a||"click"==a?(c.checked=i?!l.checked[0]:l.checked[0],i&&!r||"click"===a||(c.disabled=l.disabled[0],c.indeterminate=l.indeterminate[0])):"checked"==a||"unchecked"==a?c.checked="checked"==a:"disabled"==a||"enabled"==a?c.disabled="disabled"==a:"indeterminate"==a||"determinate"==a?c.indeterminate="determinate"!==a:c.checked=!l.checked[0],H(e,t,l,c,n,s,a,o,i,r)},H=function(e,t,a,o,i,r,s,l,c,d,p){var u,h,f,g,b,y,w,k,_,T,C=e.type,S="radio"==C?"Radio":"Checkbox";if(t||(t=N(e,"div",r.className)),t){for(u in o)if(h=o[u],a[u][0]!==h&&"updated"!==s&&"click"!==s&&(e[u]=h),d&&(h?e.setAttribute(u,u):e.removeAttribute(u)),r[u]!==h){if(r[u]=h,_=!0,"checked"==u&&(T=!0,!p&&h&&(m[i].done||d)&&"radio"==C&&e.name))for(g=N(e,"form",""),f='input[name="'+e.name+'"]',f=g&&!d?n(g).find(f):n(f),g=f.length;g--;)b=f[g],y=v(b.className),e!==b&&m[y]&&m[y].checked&&(w={checked:[!0,"Checked","Unchecked"]},k={checked:!1},H(b,!1,w,k,y,m[y],"updated",l,c,d,!0));if(f=[r[u+"Class"],r[u+S+"Class"],r[a[u][1]+"Class"],r[a[u][1]+S+"Class"],r[u+"LabelClass"]],g=[f[3]||f[2],f[1]||f[0]],h&&g.reverse(),A(t,g),r.mirror&&f[4])for(g=n("label."+r.esc);g.length--;)A(g[g.length],f[4],h?1:0);l&&!p||$(e,i,a[u][h?1:2])}(!l||p)&&(_&&$(e,i,"Changed"),T&&$(e,i,"Toggled")),r.cursor&&!x&&(r.disabled||r.pointer?r.disabled&&r.pointer&&(t.style.cursor="default",r.pointer=!1):(t.style.cursor="pointer",r.pointer=!0)),m[i]=r}};n.fn.icheck=function(e,t){if(/^(checked|unchecked|indeterminate|determinate|disabled|enabled|updated|toggle|destroy|data|styler)$/.test(e))for(var n=P(this),a=n.length;a--;){var o=n[a],i=v(o.className);if(i){if("data"==e)return m[i];if("styler"==e)return N(o,"div",m[i].className);"destroy"==e?I(o,i,"Destroyed"):D(o,!1,i,e),"function"==typeof t&&t(o)}}else"object"!=typeof e&&e||L(this,e||{});return this};var U;n(t).on("click.i "+o+k,"label."+p+",div."+l,function(e){var t=this,a=v(t.className);if(a){var o,s,l,c,d=e.type,p=m[a],u=p.esc,a="DIV"==t.tagName,h=[["label",p.activeLabelClass,p.hoverLabelClass],["div",p.activeClass,p.hoverClass]];if(a&&h.reverse(),d==E||d==R){if(h[0][1]&&A(t,h[0][1],d==E?1:0),p.mirror&&h[1][1])for(l=n(h[1][0]+"."+u);l.length--;)A(l[l.length],h[1][1],d==E?1:0);a&&d==R&&p.tap&&x&&y&&!r&&(c=!0)}else if(d==C||d==S){if(h[0][2]&&A(t,h[0][2],d==C?1:0),p.mirror&&h[1][2])for(l=n(h[1][0]+"."+u);l.length--;)A(l[l.length],h[1][2],d==C?1:0);a&&d==S&&p.tap&&x&&w&&!r&&(c=!0)}else a&&(x&&(w||y)&&p.tap&&!r||(c=!0));c&&setTimeout(function(){s=e.currentTarget||{},"LABEL"!==s.tagName&&(!p.change||+new Date-p.change>100)&&(o=n(t).find("input."+u).click(),(i||r)&&o.change())},2)}}).on("click.i change.i focusin.i focusout.i keyup.i keydown.i","input."+d,function(e){var t=v(this.className);if(t){var a=e.type,o=m[t],i=o.esc,r="click"==a?!1:N(this,"div",o.className);if("click"==a)m[t].change=+new Date,e.stopPropagation();else if("change"==a)r&&!this.disabled&&D(this,r,t,"click");else if(~a.indexOf("focus")){if(e=[o.focusClass,o.focusLabelClass],e[0]&&r&&A(r,e[0],"focusin"==a?1:0),o.mirror&&e[1])for(o=n("label."+i);o.length--;)A(o[o.length],e[1],"focusin"==a?1:0)}else r&&!this.disabled&&("keyup"==a?(("checkbox"==this.type&&32==e.keyCode&&o.keydown||"radio"==this.type&&!this.checked)&&D(this,r,t,"click",!1,!0),m[t].keydown=m[U].keydown=!1):(U=t,m[t].keydown=!0))}}).ready(function(){if(e.icheck.autoInit&&n("."+s).icheck(),e.jQuery){var a=t.body||t.getElementsByTagName("body")[0];n.ajaxSetup({converters:{"text html":function(o){if(e.icheck.autoAjax&&a){var r,l=t.createElement("iframe");i||(l.style="display:none"),l.className="iframe.icheck-frame",l.src="about:blank",a.appendChild(l),r=l.contentDocument?l.contentDocument:l.contentWindow.document,r.open(),r.write(o),r.close(),a.removeChild(l),r=n(r),L(r.find("."+s),{},!0),r=r[0],o=(r.body||r.getElementsByTagName("body")[0]).innerHTML}return o}}})}})},"function"==typeof define&&define.amd?define("icheck",[e.jQuery?"jquery":"zepto"],e.ichecked):e.ichecked())}(window,document);var SHURSCRIPT={GreaseMonkey:{log:GM_log,getValue:GM_getValue,setValue:GM_setValue,deleteValue:GM_deleteValue,xmlhttpRequest:GM_xmlhttpRequest,registerMenuCommand:GM_registerMenuCommand,addStyle:GM_addStyle,getResourceText:GM_getResourceText,getResourceURL:GM_getResourceURL},config:{server:"http://cloud.shurscript.org:8080/"},environment:{page:-1!=location.pathname.indexOf("/foro")?location.pathname.replace("/foro",""):"frontpage",thread:{id:getCurrentThread(),page:getCurrentPage(),isClosed:null===document.getElementById("qrform")}}};(function(e,t,n,a,o,i){"use strict";var r={},s=n.GreaseMonkey;n.core=r;var l=function(){var e;if("undefined"!=typeof GM_info)e=GM_info.script.version;else{if("undefined"==typeof GM_getMetadata)return!1;e=GM_getMetadata("version")+""}var t=e.split("-");return n.scriptVersion=t[0],n.scriptBranch=t[1]||"master",!0},c={__init__:function(e){return this.moduleId=e,delete this.__init__,this},log:function(t){o.log(this._getCallerDescription()+t);var n=e("#shurscript_log");0===n.length&&(e(document.body).append('<div id="shurscript_log" style="display:none;"></div>'),n=e("#shurscript_log")),n.append(t+"<br>")},_getShurKey:function(e,t){var a=t===!0?"_"+n.environment.user.id:"";return"SHURSCRIPT_"+this.moduleId+"_"+e+a},_getCallerDescription:function(){return"[SHURSCRIPT]  [Modulo "+this.moduleId+"] "+(new Date).toLocaleTimeString()+": "},setValue:function(e,t,n){s.setValue(this._getShurKey(e,!1),t,n)},getValue:function(e,t){return s.getValue(this._getShurKey(e,!1),t)},deleteValue:function(e,t){s.deleteValue(this._getShurKey(e,!1),t)},setLocalValue:function(e,t){GM_setValue(this._getShurKey(e,!0),t)},getLocalValue:function(e,t){return GM_getValue(this._getShurKey(e,!0),t)},deleteLocalValue:function(e){GM_deleteValue(this._getShurKey(e,!0))},"throw":function(e,t){this.log("[EXCEPTION] - "+e),t!==i&&(this.log(t),o.log(t))},addStyle:function(e){var t=s.getResourceText(e);s.addStyle(t)},showMessageBar:function(e){n.topbar.showMessage(e)},getResourceText:s.getResourceText,getResourceURL:s.getResourceURL,bootbox:a,location:location},d=function(){var e=Object.create(c);return e.createPreferenceOption=n.preferences.createOption,e.templater=n.templater,e.environment=n.environment,e};r.createComponentHelper=function(e){return Object.create(c).__init__(e)},r.createModuleHelper=function(e){return d().__init__(e)},r.helper=r.createComponentHelper("core"),r.createComponent=function(e){e===i&&r.helper.throw("Error al crear componente. El ID no ha sido definido.");var t={id:e};return n[e]=t,r.components===i&&(r.components=[]),r.components.push(e),t.helper=r.createComponentHelper(t.id),t},r.initialize=function(){if(!l())return alert("SHURSCRIPT: El complemento o extensión de userscripts que usas en tu navegador no está soportado."),i;var a=e("body").html(),o=/userid=(\d*)/.exec(a);if(o){var s,c=o[1];s="frontpage"===n.environment.page?e(".cajascat td.cat:nth-child(1)").text().substr(3):e(".smallfont a[href='member.php?u="+c+"']").first().text(),n.environment.user={id:c,name:s},n.environment.browser={name:navigator.userAgent},r.helper.addStyle("bootstrapcss"),r.helper.bootbox.setDefaults({locale:"es",className:"shurscript",closeButton:!1}),e.ajax({type:"GET",url:n.config.server+"config-"+n.scriptBranch}).done(function(e){t.extend(n.config,e),r.loadNextComponent(),r.helper.deleteLocalValue("SERVER_DOWN_ALERT")}).fail(function(){r.helper.getLocalValue("SERVER_DOWN_ALERT")||setTimeout(function(){r.helper.showMessageBar({message:"<strong>Oops...</strong> No se ha podido contactar con el cloud de <strong>shurscript</strong>. Consulta qué puede estar causando este problema en <a href='https://github.com/TheBronx/shurscript/wiki/FAQ#no-se-ha-podido-contactar-con-el-cloud-de-shurscript'>las F.A.Q.</a> y si el problema persiste, deja constancia en el <a href='"+n.config.fcThread+"'>hilo oficial</a>. <strong>{err: config}</strong>",type:"danger",onClose:function(){r.helper.setLocalValue("SERVER_DOWN_ALERT",!0)}})},3e3)})}},r.loadNextComponent=function(){var e=r.getNextComponent();return e===i?(n.moduleManager.startOnDocReadyModules(),i):(n.eventbus.trigger("loadingComponent",e),t.isFunction(e.loadAndCallback)?(r.helper.log("Cargando componente "+e.id),e.loadAndCallback(r.loadNextComponent),i):(t.isFunction(e.load)&&e.load(),r.loadNextComponent(),i))},r.getNextComponent=function(){return r.components!==i?(r.componentIndex===i?r.componentIndex=0:r.componentIndex+=1,n[r.components[r.componentIndex]]):i},r.initializeEagerly=function(){n.moduleManager.startEagerModules()}})(jQuery,_,SHURSCRIPT,bootbox,console),function(e,t){"use strict";var n=t.core.createComponent("eventbus"),a=e({});n.on=function(e,t){a.on(e,t)},n.one=function(e,t){a.one(e,t)},n.off=function(e,t){a.off(e,t)},n.trigger=function(e,t){a.trigger(e,t)},n.triggerDelayed=function(e,t,a){setTimeout(function(){n.trigger(e,a)},t)}}(jQuery,SHURSCRIPT),function(e,t,n){"use strict";function a(){var t=i.helper.getLocalValue("API_KEY");if(!t){var n=new XMLHttpRequest;n.open("GET","http://www.forocoches.com/foro/subscription.php?do=editfolders",!1),n.onreadystatechange=function(){if(4==n.readyState&&"OK"==n.statusText){var a=e.parseHTML(n.responseText),o=e(a).find("input[name='folderlist[50]']");o.length>0&&(t=o.val().replace("shurkey-",""),i.helper.setLocalValue("API_KEY",t))}},n.send()}return t}function o(t){var n=new XMLHttpRequest;n.open("POST","http://www.forocoches.com/foro/subscription.php?do=doeditfolders",!1),n.onreadystatechange=function(){4==n.readyState&&"OK"==n.statusText&&0==a()&&o(t)};var i="shurkey-"+t,r=e("input[name='securitytoken']").val(),s="s=&securitytoken="+r+"&do=doeditfolders&folderlist[50]="+i+"&do=doeditfolders";n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.setRequestHeader("Content-length",s.length),n.setRequestHeader("Connection","close"),n.send(s)}var i=t.core.createComponent("sync");({setValue:t.GreaseMonkey.setValue,getValue:t.GreaseMonkey.getValue,deleteValue:t.GreaseMonkey.deleteValue});var r={server:t.config.server,apiKey:"",preferences:{},setValue:function(t,n,a){GM_xmlhttpRequest({method:"PUT",url:this.server+"preferences/"+t+"/?apikey="+this.apiKey,data:e.param({value:n}),headers:{"Content-Type":"application/x-www-form-urlencoded"},onload:function(e){a&&a(JSON.parse(e.responseText))}})},getValue:function(e,t){GM_xmlhttpRequest({method:"GET",url:this.server+"preferences/"+e+"/?apikey="+this.apiKey,data:"",onload:function(e){t&&t(JSON.parse(e.responseText))}})},getAll:function(e){t.config.apiKey=this.apiKey,i.helper.log("Cloud.getAll() using API key: "+this.apiKey),GM_xmlhttpRequest({method:"GET",url:this.server+"preferences/?apikey="+this.apiKey,data:"",onload:function(t){r.preferences=JSON.parse(t.responseText),e()},onerror:function(n){switch(n.status){case 403:bootbox.confirm("<h3>¡Un momento!</h3>La Shurkey que estás utilizando no es válida. ¿Quieres que te generemos una nueva?",function(t){t&&r.generateApiKey(function(){r.getAll(e)})});break;case 410:i.helper.deleteLocalValue("API_KEY"),r.apiKey=a(),r.getAll(e);break;case 500:default:i.helper.showMessageBar({message:"<strong>Oops...</strong> No se ha podido contactar con el cloud de <strong>shurscript</strong>. Consulta qué puede estar causando este problema en <a href='https://github.com/TheBronx/shurscript/wiki/FAQ#no-se-ha-podido-contactar-con-el-cloud-de-shurscript'>las F.A.Q.</a> y, si el problema persiste, deja constancia en el <a href='"+t.config.fcThread+"'>hilo oficial</a>. <strong>{err: general}</strong>",type:"danger"})}i.helper.throw("Error al recuperar las preferencias",n)}})},deleteValue:function(e,t){this.setValue(e,"",t)},generateApiKey:function(e,t){i.helper.deleteLocalValue("API_KEY"),i.helper.log("Cloud.generateApiKey()"),GM_xmlhttpRequest({method:"POST",url:this.server+"preferences/"+(t!==n?"?apikey="+t:""),data:"",onload:function(t){var n=JSON.parse(t.responseText);i.helper.log("Generated API Key:"+JSON.stringify(n)),r.apiKey=n.apikey,o(r.apiKey),e()}})}};i.loadAndCallback=function(e){t.GreaseMonkey.setValue=function(e,t,n){r.preferences[e]=t,r.setValue(e,t,n)},t.GreaseMonkey.getValue=function(e,t){return r.preferences[e]!=n?r.preferences[e]:t},t.GreaseMonkey.deleteValue=function(e,t){r.deleteValue(e,t)};var o=a();o?(r.apiKey=o,r.getAll(e)):r.generateApiKey(function(){r.getAll(e)})},i.generateNewApiKey=function(e){r.generateApiKey(e,a())}}(jQuery,SHURSCRIPT),function(e,t){"use strict";function n(e,t){t.preferences.enabled&&o(t)}function a(e,t){o(t)}function o(e){e.shurbarIcon!==undefined&&i(e.shurbarIcon(),e)}function i(t,n){e.isArray(t)||(t=[t]),t.forEach(function(e){c.push(new d(n&&n.id,e.name,e.description,e.image,e.handler))})}function r(){c.forEach(function(t){e('<li class="shurbar-item" id="'+t.name+'" data-placement="top" data-toggle="tooltip" title="'+t.description+'"><img src="'+t.image+'"/><a href="#">'+t.name+"</a></li>").prependTo(e("#shurbar ul.shurbar-items")).click(t.handler).tooltip({delay:300})})}var s=t.core.createComponent("shurbar"),l='<div id="shurbar" class="shurscript"><div class="pull-right"><ul class="nav navbar-nav shurbar-items"></ul></div></div>',c=[],d=function(e,t,n,a,o){this.moduleId=e,this.name=t,this.description=n,this.image=a,this.handler=o};s.load=function(){s.helper.addStyle("shurbarcss"),e("#AutoNumber9").attr("cellpadding",0);var o;if("frontpage"==t.environment.page){o=e(".cajastip");var i=o.find(".texto:nth-child(2)").html();e("#AutoNumber8").html(i.replace("|","<br/>")),e("#AutoNumber8").addClass("texto"),e("#AutoNumber8").css("margin","7px 0 0 7px")}else o=e("#AutoNumber7").parents(".cajasprin");var c=e('<div id="quick-search-form" class="pull-left">'+o.find("form").parent().html()+"</div>");c.find(".cbutton").addClass("btn btn-default"),c.find(".cfield").addClass("form-control"),c.find("form").append(c.find("input"));var d=e(l);d.append(c),o.replaceWith(d),t.eventbus.on("loadingComponent",a),t.eventbus.on("loadingModule",n),t.eventbus.on("allModulesLoaded",function(){r()})}}(jQuery,SHURSCRIPT),function(e,t,n){"use strict";var a=t.core.createComponent("moduleManager");a.ALL="ALL",a.NO_FRONTPAGE="NO_FRONTPAGE";var o={__init__:function(o){var i=["id","name","author","version","description"],r=this;return e.each(i,function(e,t){if(o[t]===n){var i=o.id||o.name||"no identificado",s="Error generando modulo {"+i+"}.El parametro "+t+" no ha sido definido.";a.helper.log(s),a.helper.throw(s)}r[t]=o[t]}),this.initialPreferences=o.initialPreferences||{},this.preferences={enabled:!0},o.domain!==n&&(this.domain=o.domain),this.helper=t.core.createModuleHelper(o.id),a.modules[this.id]=this,delete this.__init__,this},preferences:{enabled:!0},storePreferences:function(e){var t=JSON.stringify(this.preferences);this.helper.setValue("__preferences",t,e)},refreshPreferences:function(){var t=this.helper.getValue("__preferences",""),a={};t!==n&&""!==t&&(a=JSON.parse(t)),e.extend(!0,this.preferences,this.initialPreferences,a)},migratePreferences:function(e){for(var t in this.preferences){for(var a="",o=0;t.length>o;o++)t[o]==t[o].toUpperCase()&&(a+="_"),a+=t[o].toUpperCase();var i=this.helper.getLocalValue(a);i!==n&&(this.preferences[t]=i,this.helper.log("Migrada: "+a+" = "+i))}this.storePreferences(e)},migrateValues:function(e){e&&e()},domain:a.NO_FRONTPAGE,getPreferenceOptions:function(){return[]},eagerStartCheck:function(){return!1},onEagerStart:function(){},isValidPage:function(){var e=this.domain,n=t.environment.page;return"string"==typeof e?e===a.ALL?!0:e===a.NO_FRONTPAGE?"/"!==n:n===e:e.indexOf(n)>-1},normalStartCheck:function(){return!0},onNormalStart:function(){}};a.modules={},a.createModule=function(e){try{return Object.create(o).__init__(e)}catch(t){mod.helper.throw("Error creando módulo:",t)}},a.migratePreferences=function(n){bootbox.dialog({message:"<center>Migrando preferencias...</center>"});var o=0,i=0,r=function(){o++,o==i&&a.helper.setValue("MIGRATION_DONE",!0,function(){n(),bootbox.hideAll()})},s=GM_getValue("SHURSCRIPT_MODULES_"+t.environment.user.id);s&&(s=JSON.parse(s),e.each(s,function(e,t){try{a.modules[e].preferences.enabled=t,a.helper.log("Migrando active status de "+e+": "+t)}catch(n){a.helper.throw("Error al migrar el active status de "+e,n)}})),e.each(a.modules,function(e,t){try{i++,t.migratePreferences(function(){t.migrateValues(r)})}catch(n){a.helper.throw("Error migrando las preferencias antiguas del modulo "+e,n)}})},a.startOnDocReadyModules=function(){return-1!=a.helper.location.hash.indexOf("newkey")&&a.helper.setValue("MIGRATION_DONE",!0),a.helper.getValue("MIGRATION_DONE")?(e.each(a.modules,function(e,n){try{if(n.refreshPreferences(),t.eventbus.trigger("loadingModule",[n]),!n.preferences.enabled)return!0;if(!n.isValidPage())return!0;if(!n.normalStartCheck())return!0;a.helper.log("Cargando modulo "+n.id),n.onNormalStart(),a.helper.log("Modulo "+n.id+" cargado")}catch(o){a.helper.log("Fallo cargando modulo "+n.id+"\nRazon: "+o)}}),t.eventbus.trigger("allModulesLoaded"),n):(a.migratePreferences(function(){a.startOnDocReadyModules()}),n)},a.startEagerModules=function(){e.each(a.modules,function(e,t){try{if(t.refreshPreferences(),!t.preferences.enabled)return!0;if(!t.eagerStartCheck())return!0;if(!t.isValidPage())return!0;a.helper.log("[Modo prematuro] Cargando modulo "+t.id),t.onEagerStart(),a.helper.log("[Modo prematuro] Modulo "+t.id+" cargado")}catch(n){a.helper.log("[Modo prematuro] Fallo cargando modulo "+t.id+"\nRazon: "+n)}})}}(jQuery,SHURSCRIPT),function(e,t){"use strict";function n(e){"string"==typeof e&&(e={message:e}),e.type=e.type||"info"}var a,o,i=t.core.createComponent("topbar");i.showMessage=function(t){n(t),a||(e('<div class="shurscript" style="height: 62px;">').prependTo(e("body")).append(a=e('<div style="padding: 10px; text-align: center; position: fixed; width: 99%;"><span class="message"/><button type="button" class="close" style="position: absolute; right: 15px; line-height: 15px">&times;</button></div>')),a.hide()),a.find(".message").html(t.message),a.attr("class","alert alert-"+t.type),a.slideDown();var i=function(){a.slideUp(),t.onClose&&t.onClose()};a.on("click",".close",function(){i()}),"number"==typeof t.timeout&&(o&&clearTimeout(o),o=setTimeout(function(){i()},t.timeout))}}(jQuery,SHURSCRIPT),function(e,t){"use strict";var n=t.core.createComponent("templater"),a={};n.storeTemplate=function(e,t){a[e]={tempName:e,tempText:t,compiled:!1}},n.fillOut=function(e,t){var o=a[e];o.compiled||n.compile(e);try{return a[e].tempFn(t||{})}catch(i){n.helper.throw("Error insertando valores en la plantilla:",i)}},n.compile=function(e){var t=a[e];if(!t.compiled)try{t.tempFn=Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.tempText.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"),t.compiled=!0}catch(o){n.helper.throw("Error compilando template ["+e+"]: ",o)}}}(jQuery,SHURSCRIPT),function(e,t){"use strict";function n(e){t.GreaseMonkey.xmlhttpRequest({method:"GET",url:t.config.updateURL,onload:function(t){var n=/\/\/\s*@version\s+(.+)\s*\n/i.exec(t.responseText)[1],o=n.split("-")[1];n=n.split("-")[0];var i=a(n,o);e(i,n)}})}function a(e,n){var a,o=t.scriptVersion,i=t.scriptBranch;return a="exp"==i&&"dev"==n||"dev"==i&&!n?e>=o:e>o}function o(e){s.getChangelog(function(n){bootbox.dialog({message:"<h4>Hay disponible una nueva versión ("+e+") del Shurscript.</h4><p><br></p>"+n,buttons:[{label:"Más tarde",className:"btn-default"},{label:"Actualizar",className:"btn-primary",callback:function(){bootbox.hideAll(),location.href=t.config.installURL}}]})},e)}function i(e,t){return t=t.replace(/\./g,"\\."),e=e.match(RegExp("##[#]? v"+t+"[ \n].*([\\s\\S]*?(?=---))"))[1].trim(),e=(new Markdown.Converter).makeHtml(e)}var r,s=t.core.createComponent("autoupdater"),l=36e5;s.check=function(e,t){r=(new Date).getTime();var a=parseInt(s.helper.getLocalValue("LAST_SCRIPT_UPDATE",0),10);(e||r>a+l)&&(s.helper.setLocalValue("LAST_SCRIPT_UPDATE",""+r),n(function(e,n){e&&o(n),"function"==typeof t&&t(e)}))},s.load=function(){s.check(!1)},s.getChangelog=function(e,n){t.GreaseMonkey.xmlhttpRequest({method:"GET",url:t.config.rawChangelog+"?"+r,onload:function(a){var o;try{o=i(a.responseText,n||t.scriptVersion)}catch(r){o="Haz clic <a target='_blank' href='"+t.config.visualChangelog+"'>aquí</a> para ver los cambios de esta versión."}e(o)}})}}(jQuery,SHURSCRIPT),function(e,t,n){"use strict";var a=t.core.createComponent("preferences");a.shurbarIcon=function(){return{name:"Shurscript",description:"Abrir preferencias",image:t.config.imagesURL+"roto2.gif",handler:a.onShow}},a.onShow=function(){var n=a.createModal();return e("body").append(n),n.on("hidden.bs.modal",function(){n.remove(),e("body").removeClass("prefs-open")}),n.on("show.bs.modal",function(){e("body").addClass("prefs-open")}),n.on("hide.bs.modal",function(){var e=a.$modal.find(".shur-module-preferences.changed");e.length&&bootbox.confirm("Hay cambios sin guardar en sus preferencias, ¿desea guardar los cambios?",function(e){e&&a.saveSettings()})}),n.on("click","#check-shurscript-updates",function(){a.checkUpdates()}),n.on("click",".shur-btn-options",function(){var t=e(this).parent().parent().parent().data("module-id"),a=e(this).parent().parent().find("h3").text(),o=e(this).parent().parent().siblings(".shur-options-body").show(),i=bootbox.dialog({message:o,title:"Preferencias de: ",className:"shurscript modal-module",buttons:{close:{label:"Cerrar",className:"btn-default",callback:function(){var e=i.find(".shur-options-body").hide();n.find('.shur-module-preferences[data-module-id="'+t+'"]').append(e)}}}});i.find(".modal-dialog").css({width:"700px",marginTop:"15px"}),i.find(".modal-body").css({"overflow-y":"auto",height:e(window).height()-255});var r=i.find(".modal-title");e(r).addClass("lead"),e(r).css({fontSize:"18px"}),e(r).append('<h4 style="display:inline;text-transform:lowercase;">'+a+"</h4>"),e(window).on("resize",function(){i.find(".modal-body").css("height",e(window).height()-255)}),e(window).trigger("resize"),i.on("change","input",function(){n.find("[data-module-id="+t+"]").addClass("changed")})}),n.find(".shur-btn-options").tooltip({delay:100}),n.find(".shur-radio-element").icheck({radioClass:"iradio_square-blue"}),n.on("click","#save-settings",function(){a.saveSettings()}),n.on("change","input",function(){e(this).parents(".shur-module-preferences").addClass("changed")}),n.on("click",".shur-module-enabled",function(){var t=e(this).parents(".shur-module-preferences");t.toggleClass("disabled-module"),t.addClass("changed")}),n.modal(),n.css("z-index",1e3),e(".modal-backdrop").css("z-index",999),e(window).on("resize",function(){n.find(".modal-body").css("height",e(window).height()-280)}),e(window).trigger("resize"),n.find('a[data-toggle="tab"][href="#tab-about"]').on("shown.bs.tab",function(){t.autoupdater.getChangelog(function(e){n.find("#shur-changelog .panel-body").html(e)}),e(this).off("shown.bs.tab")}),n.find('a[data-toggle="tab"][href="#tab-help"]').on("shown.bs.tab",function(){t.preferences.getFAQ(function(e){n.find("#shur-faq .panel-body").html(e)}),e(this).off("shown.bs.tab")}),n.on("click","#change-api-key",function(){bootbox.confirm("Recuerde que generar una nueva API Key elimina todos sus datos y configuraciones. Pulse en Aceptar para continuar con el proceso.",function(e){e&&(bootbox.hideAll(),bootbox.dialog({message:"<center>Generando API Key...</center>"}),t.sync.generateNewApiKey(function(){a.helper.location.href="#newkey",a.helper.location.reload()}))})}),n.on("shown.bs.modal",function(){e(".shur-tags-group input[type=text]").tokenfield({allowDuplicates:!1,delimiter:",",minLength:2,limit:500})}),n.find('a[data-toggle="tab"][href="#tab-debug"]').on("shown.bs.tab",function(){e("#debug-log").html(e("#shurscript_log").html())}),n.on("click","#debug-send",function(){bootbox.confirm("Por el bien de la comunidad, no abuse de esta utilidad y <strong>trate de ser todo lo conciso posible</strong> para ayudar a resolver el problema. Confirme que desea enviar el registro de shurscript y el suceso que ha escrito.",function(t){t&&(e.post("http://shurscript.org/report.php",e("#debug-form").serialize()),e("#debug-send").attr({disabled:"disabled",value:"Reporte enviado correctamente"}))})}),a.$modal=n,unsafeWindow.viewPlainText=function(t){bootbox.dialog({message:'<textarea id="textselect" class="form-control" style="min-height:75px;max-height:500px;overflow-y:auto;" readonly></textarea>',buttons:{seleccionar:{label:"Seleccionar el contenido",className:"btn-default",callback:function(){return e("#textselect").select(),!1}},cerrar:{label:"Cerrar",className:"btn-primary"}}});var n=e(t).attr("mapsTo");e("#textselect").text(e("input[data-maps-to='"+n+"']").tokenfield("getTokensList",","))},!1},a.checkUpdates=function(){var n=e("#check-shurscript-updates");n.button("loading"),t.autoupdater.check(!0,function(e){n.button("reset"),e||bootbox.alert("No hay actualizaciones disponibles del Shurscript")})},a.getFAQ=function(n){t.GreaseMonkey.xmlhttpRequest({method:"GET",url:t.config.visualFAQ,onload:function(a){var o;try{o=e(a.responseText).find(".markdown-body"),o=e(o).find("hr").remove().end(),o=e(o).find("blockquote:first").remove().end()}catch(i){o="Haz clic <a target='_blank' href='"+t.config.visualFAQ+"'>aquí</a> para ver los cambios de esta versión."}n(o)}})},a.saveSettings=function(){var n=0,o=a.$modal.find(".shur-module-preferences.changed");o.length?(bootbox.dialog({message:"<center>Guardando cambios...</center>"}),o.each(function(i,r){var s=e(r),l=s.data("module-id"),c=t.moduleManager.modules[l],d=c.preferences;d.enabled=s.find(".shur-module-enabled").is(":checked"),s.find(".shur-option").each(function(t,n){var a,o,i,r=e(n);r.hasClass("shur-radio-group")?(a=r.find(".icheck-item.checked input[type=radio]"),o=a.val()):r.hasClass("shur-checkbox-group")?(a=r.find(".shur-checkbox input"),o=a.is(":checked")):r.hasClass("shur-text-group")?(a=r.find("input"),o=a.val()):r.hasClass("shur-tags-group")&&(a=r.find("input"),o=a.val()),i=a.data("maps-to"),d[i]=o}),c.storePreferences(function(){n++,n>=o.length&&a.helper.location.reload()})})):a.$modal.modal("hide")},a.createModal=function(){var n={scriptVersion:t.scriptVersion,scriptBranch:t.scriptBranch,apiKey:t.config.apiKey,visualFAQ:t.config.visualFAQ,visualChangelog:t.config.visualChangelog,userDebug:t.environment.user.name,userIdDebug:t.environment.user.id,urlDebug:t.preferences.helper.location.href,agentDebug:t.environment.browser.name,modules:[]};return e.each(t.moduleManager.modules,function(e,t){n.modules.push({id:t.id,name:t.name,description:t.description,options:t.getPreferenceOptions(),preferences:t.preferences})}),e(t.templater.fillOut("modal",n))},a.load=function(){a.helper.addStyle("modalcss"),-1!=a.helper.location.hash.indexOf("newkey")&&(a.onShow(),a.$modal.find('a[data-toggle="tab"][href="#tab-about"]').tab("show"),setTimeout(function(){a.helper.location.href="#"},1e3))},a.createOption=function(t){var o=["checkbox","radio","text","color","header","tags"],i=["type","caption"],r="Error creando opcion: ";return e.each(i,function(e,o){t[o]===n&&a.helper.throw(r+o+" no esta definido")}),-1===o.indexOf(t.type)&&a.helper.throw(r+type+" no es un tipo valido de opcion"),"radio"===t.type&&("[object Array]"!==Object.prototype.toString.call(t.elements)&&a.helper.throw(r+".elements no es un array"),e.each(t.elements,function(e,t){(t.value===n||t.caption===n)&&a.helper.throw(r+"Al elemento radio numero "+e+" le falta la propiedad value y/o caption"),t.subCaption=t.subCaption||""
})),"header"!==t.type&&t.mapsTo===n&&a.helper.throw(r+".mapsTo no esta definido"),t.subCaption=t.subCaption||"",t},setTimeout(function(){var e="modal",n=a.helper.getResourceText("modalhtml");t.templater.storeTemplate(e,n),t.templater.compile(e)},0)}(jQuery,SHURSCRIPT),function(e,t){"use strict";function n(){"frontpage"===g.helper.environment.page?(e("#AutoNumber1.contenido tr:first-child").append('<td style="padding: 0px;" rowspan=3 class="alt2"><div class="notifications">0</div></td>'),GM_addStyle("#notificationsBox {right: 19px;}")):e(".page table td.alt2[nowrap]").first().parent().append('<td style="padding: 0px;" class="alt2"><div class="notifications">0</div></td>'),e(".notifications").click(function(){("ERROR"==O||!w||Date.now()-parseFloat(w)>6e4)&&a(),C.is(":visible")?C.hide():r()}),"off"!=b&&"/search.php"!=g.helper.environment.page&&(!w||Date.now()-parseFloat(w)>1e3*60*b)?a(!0):(s(_),O="OK")}function a(t){t=t!==undefined?t:!1,e(".notifications").html("..."),O="QUERY",y=new XMLHttpRequest,y.onreadystatechange=function(){if(4==y.readyState&&"OK"==y.statusText)try{w=Date.now();var n=e.parseHTML(y.responseText),i=e(n).find("#inlinemodform table[id*='post']");if(0==i.length){if(-1!=y.responseText.indexOf("debes estar registrado o identificado")){O="ERROR";var l=e(".notifications");return l.attr("title","Ha ocurrido un error al cargar las notificaciones. Contacta con los desarrolladores en el hilo oficial del Shurscript (ForoCoches)."),l.html("X"),undefined}var d=e(n).find(".page li").text();if(d&&!t){d=d.substring(d.indexOf("aún")+4);var m=d.substring(0,d.indexOf(" ")),v=parseInt(m)+1,b=setInterval(function(){v>0?o("...<sup>"+v--+"</sup>"):(a(),clearInterval(b))},1e3);return}if(t&&_.length>0)return s(_),O="OK",undefined}var T,C=Array();if(x){x=parseInt(x),"NaN"==typeof x&&(x=x.match(/#post([\d]*)/)[1]);for(var S=g.preferences.ignoredUsers.split(/\s*,\s*/),E=0;i.length>E&&(T=new h(i[E],!1),!(x>=T.postID));E++)-1===S.indexOf(T.userName)&&(g.preferences.mentionsToo||f(T))&&C.push(T)}i.length>0&&(x=new h(i[0]).postID,g.helper.setValue("LAST_READ_QUOTE",x));var R=[],M=[];_=C.concat(_);for(var E=0;_.length>E;E++)_[E].read?M.push(_[E]):R.push(_[E]);_=R.concat(M.slice(0,10-R.length)),k=JSON.stringify(_),g.helper.setValue("LAST_QUOTES_UPDATE",""+Date.now()),g.helper.setValue("LAST_QUOTES",k),s(_),O="OK",g.preferences.showAlerts&&t&&(1==C.length?(T=C[0],bootbox.dialog({message:"El usuario <b>"+T.userName+"</b> te ha citado en el hilo <b>"+T.threadName+"</b><p><br></p><i>"+T.postText+"</i><p><br></p>¿Quieres ver el post ahora?",buttons:[{label:"Ya leída",className:"btn-default",callback:function(){p(T),s(_)}},{label:"Más tarde",className:"btn-default"},{label:"Abrir post",className:"btn-default",callback:function(){p(T,function(){u(T,"_self")})}},{label:"En nueva ventana",className:"btn-primary",callback:function(){p(T,function(){u(T,"_blank"),s(_)})}}]})):C.length>1&&bootbox.dialog({message:"Tienes <b>"+C.length+" citas nuevas</b> en el foro ¿Quieres verlas ahora?",buttons:[{label:"Ya leídas",className:"btn-default",callback:function(){c()}},{label:"Más tarde",className:"btn-default"},{label:"Ver lista",className:"btn-default",callback:function(){e("html, body").animate({scrollTop:0},"slow"),r()}},{label:"Abrir todas en pestañas",className:"btn-primary",callback:function(){c(function(){C.forEach(function(e){u(e,"_blank")})})}}]}))}catch(A){g.helper.throw(A)}},y.open("GET",v,!0),y.send()}function o(t){var n=e(".notifications");t>0?(document.title="("+t+") - "+R,n.attr("title","Tienes "+t+" "+(1==t?"notificación no leída":"notificaciones no leídas")),n.addClass("unread")):(document.title=R,n.attr("title","No tienes ninguna notificación nueva"),n.removeClass("unread")),T=t,n.html(t)}function i(){C=e("<div id='notificationsBox'/>"),S=e("<div id='notificationsList'/>"),e(document.body).append(C),C.append(S),e(document).mouseup(function(t){"block"!=C.css("display")||C.is(t.target)||e(".notifications").is(t.target)||0!==C.has(t.target).length||(C.hide(),t.stopImmediatePropagation(),t.stopPropagation(),t.preventDefault())})}function r(){C.css("top",e(".notifications").offset().top+e(".notifications").outerHeight()+6),C.show()}function s(t){S.html('<div id="noNotificationsMessage">No tienes ninguna notificación</div>');for(var n=0,a=0;t.length>a;a++)d(t[a]),t[a].read||n++;if(o(n),!E){E=e("<table id='notificationsListButtons' border='0' cellspacing='0'><tr></tr></table>");var i=e("<td title='Marcar todas las citas como leídas'/>");if(i.html("Marcar como leídas"),i.click(function(){c()}),E.append(i),g.preferences.openInTabsButton){var r=e("<td title='Abrir todas las citas no leídas en diferentes pestañas'/>");r.html("Abrir en pestañas"),r.click(function(){var e=l();c(function(){e.forEach(function(e){u(e,"_blank")})})}),E.append(r)}C.append(E)}n>0?E.show():E.hide()}function l(){var e=[];return _.forEach(function(t){t.read||e.push(t)}),e}function c(e){for(var t=0;_.length>t;t++)_[t].read=!0;s(_),k=JSON.stringify(_),g.helper.setValue("LAST_QUOTES",k,e),C.hide()}function d(t){e("#noNotificationsMessage").hide();var n=function(e){return 0===e.indexOf("http")?e:"/foro/"+e},a=n(t.userLink),o=n(t.threadLink),i=n(t.postLink),r=e(SHURSCRIPT.templater.fillOut("quote",{cita:t,postLink:i,threadLink:o,userLink:a}));r.on("mouseup",".postLink",function(e){3===e.which||t.read||p(t,function(){1!==e.which||e.ctrlKey||e.metaKey||u(t,"_self")})}),M[t.postID]=r,S.append(r)}function p(e,t){e.read=!0,k=JSON.stringify(_),g.helper.setValue("LAST_QUOTES",k,t),o(T-1),M[e.postID].addClass("read")}function u(e,t){window.open(0==e.postLink.indexOf("http")?e.postLink:"/foro/"+e.postLink,t)}function h(t,n){var a=e(t).find(".smallfont > em > a");this.postLink=a.attr("href"),this.postText=a.text().replace(/</g,"&lt;"),this.postID=this.postLink.match(/#post([\d]*)/)[1];var o=e(t).find(".alt1 > div > a > strong");this.threadLink=o.parent().attr("href"),this.threadName=o.text();var i=e(t).find(".smallfont > a");this.userLink=i.attr("href"),this.userName=i.text(),this.read=n}function f(t){var n=!1;return y=new XMLHttpRequest,y.onreadystatechange=function(){if(4==y.readyState&&"OK"==y.statusText){var a=e.parseHTML(y.responseText),o=e(a).find("#post_message_"+t.postID).text(),i=g.helper.environment.user.name.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");o.match(RegExp("Originalmente Escrito por "+i,"i"))&&(n=!0)}},y.open("GET",t.postLink,!1),y.send(),n}function m(){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===t.readyState&&200===t.status){var n=t.responseText,a=new DOMParser,o=a.parseFromString(n,"text/html"),i=o.getElementById("ignorelist");if(i){for(var r=i.getElementsByTagName("a"),s=[],l=0,c=r.length;c>l;l++)s.push(r[l].textContent);var d=s.join(", "),p=e("input[data-maps-to='ignoredUsers']").tokenfield("getTokensList",",");s.length>0&&(p?d!==p?bootbox.confirm("<p>La lista actual se sobreescribirá con el nuevo listado que se obtenga de tu <a href='/foro/profile.php?do=ignorelist' target='_blank'>lista de ignorados</a>.</p><p>¿Desea continuar?</p>",function(t){t&&e("input[data-maps-to='ignoredUsers']").tokenfield("setTokens",d)}):bootbox.alert("No hemos detectado cambios en tu <a href='/foro/profile.php?do=ignorelist' target='_blank'>lista de ignorados</a> desde la última importación. Realiza cambios en tus ignorados antes de volver a intentarlo."):e("input[data-maps-to='ignoredUsers']").tokenfield("setTokens",d))}else bootbox.alert("Tu <a href='/foro/profile.php?do=ignorelist' target='_blank'>lista de ignorados</a> está vacía. Para ocultar los posts de tus usuarios ignorados... ¡primero ignora a alguien!")}},t.open("GET","/foro/profile.php?do=ignorelist",!0),t.send()}var g=t({id:"Quotes",name:"Notificador de citas y menciones",author:"xusoO",version:"0.2",description:"Avisará al usuario cada vez que alguien le cite en un post, mostrando alertas y un listado de las ultimas citas no leídas.",domain:"ALL",initialPreferences:{enabled:!0,showAlerts:!0,mentionsToo:!0,openInTabsButton:!1,refreshEvery:2,ignoredUsers:""}});g.getPreferenceOptions=function(){var e=g.helper.createPreferenceOption;unsafeWindow.chromeTabsWarning=function(){bootbox.alert("<p>Si al darle al botón de Abrir en pestañas solo os abre una pestaña y no todas, es porque tenéis bloqueados los pop-ups para Forocoches, tendréis que permitirselos para poder abrir las notificaciones en pestañas.</p>				<p>Pero eso no es todo, Google Chrome por norma general solo te abrirá el primer enlace en una nueva pestaña. El resto te los abrirá en ventanas independientes.</p>				<p>Cómo sabemos que esto puede ser molesto y no existe solución por nuestra parte, en el caso que de verdad quieras usar esta funcionalidad de abrir las notificaciones en pestañas, 				deberás instalar <a target='_blank' href='https://chrome.google.com/webstore/detail/one-window/papnlnnbddhckngcblfljaelgceffobn/related'>esta extensión</a> que aunque no es una solución muy limpia, hace su función.</p>				<p>Para evitar confusiones, decir que esto no tiene nada que ver con abrir una única notificación en una nueva pestaña, eso funciona perfectamente. El problema descrito solo aplica cuando se abre más de una a la vez.</p> <p>Disculpa las molestias</p>")};var t=function(){m()};return"function"==typeof exportFunction?exportFunction(t,unsafeWindow,{defineAs:"Quotes_importIgnoreList"}):unsafeWindow.Quotes_importIgnoreList=t,[e({type:"checkbox",mapsTo:"showAlerts",caption:"Mostrar una alerta en el navegador cada vez que llegue una nueva notificación"}),e({type:"checkbox",mapsTo:"mentionsToo",caption:"Notificarme también cuando alguien me mencione en un hilo, no solo cuando me citen",subCaption:"<br/>Desmarca esta opci&oacute;n si tienes problemas con tu nick o te llegan citas que no deber&iacute;an llegarte"}),e({type:"checkbox",mapsTo:"openInTabsButton",caption:"Mostrar botón en la lista de notificaciones para abrir las no leídas en pestañas. <b style='text-decoration:underline;' onclick='chromeTabsWarning()'>Leer usuarios de Chrome</b>"}),e({type:"radio",elements:[{value:2,caption:"Cada 2 minutos"},{value:10,caption:"Cada 10 minutos"},{value:30,caption:"Cada 30 minutos"},{value:"off",caption:"Manualmente",subCaption:"Haciendo clic en el contador de notificaciones"}],caption:"Buscar citas:",mapsTo:"refreshEvery"}),e({type:"tags",mapsTo:"ignoredUsers",caption:"No mostrar citas de los siguientes usuarios <b>(separados por comas)</b>",buttons:!0,plain:!0,button1:'<a href="#" onclick="Quotes_importIgnoreList(); return false;" class="btn btn-xs btn-default">Importar de la lista de ignorados</a>'})]},GM_addStyle(".notifications {cursor: pointer; text-align: center; padding: 3px 0px; width: 70px; background: #CECECE; color: gray; font-size: 24pt;}"),GM_addStyle(".notifications.unread {background: #CC3300; color: white;}"),GM_addStyle(".notifications.unread:hover {background: #E64D1A; color: white;}"),GM_addStyle(".notifications sup {font-size: 10px;}"),GM_addStyle("#notificationsBox {background: #FFF;border: 1px solid #C30;position: absolute;display: none;box-shadow: 0 2px 4px -2px;right: 11px;font:10pt verdana,geneva,lucida,'lucida grande',arial,helvetica,sans-serif}"),GM_addStyle("#notificationsBox #notificationsList{overflow: auto;max-height: 380px;min-height: 83px;width: 340px;}"),GM_addStyle("#notificationsBox:after, #notificationsBox:before {bottom: 100%;border: solid transparent;content: ' ';height: 0;width: 0;position: absolute;pointer-events: none;}"),GM_addStyle("#notificationsBox:after {border-color: rgba(255, 255, 255, 0);border-bottom-color: #fff;border-width: 10px;left: 92%;margin-left: -13px;}"),GM_addStyle("#notificationsBox:before {border-color: rgba(204, 51, 0, 0);border-bottom-color: #CC3300;border-width: 11px;left: 92%;margin-left: -14px;}"),GM_addStyle("#notificationsList a.postLink {font-weight: normal;}"),GM_addStyle(".notificationRow {overflow: visible; padding: 6px; font-size: 9pt; color: #444;border-bottom:1px solid lightgray;}"),GM_addStyle(".notificationRow > div {margin-top: 2px;}"),GM_addStyle(".notificationRow.read {color: #AAA !important;}"),GM_addStyle(".notificationRow.read a {color: #888 !important;}"),GM_addStyle(".notificationRow:hover {background: #eee;}"),GM_addStyle("#noNotificationsMessage {text-align: center; line-height: 83px; font-size: 12pt; color: #646464;}"),GM_addStyle("#notificationsListButtons td {background: #CC3300;color: white;cursor: pointer;font-size: 10pt;height: 30px;line-height: 30px;text-align: center;border-right: 1px solid white;}"),GM_addStyle("#notificationsListButtons td:last-child {border: none;}"),GM_addStyle("#notificationsListButtons td:hover {background: #E64D1A;}"),GM_addStyle("#notificationsListButtons {width: 100%;}"),GM_addStyle("#AutoNumber1.contenido .notifications {padding: 6px 0px;}");var v,b,y,w,x,k,_,T,C,S,E,R,O="QUERY";g.migrateValues=function(e){g.helper.getValue("LAST_QUOTES_UPDATE")?e():g.helper.setValue("LAST_QUOTES_UPDATE",g.helper.getLocalValue("LAST_QUOTES_UPDATE"),function(){g.helper.setValue("LAST_READ_QUOTE",g.helper.getLocalValue("LAST_READ_QUOTE"),function(){g.helper.setValue("LAST_QUOTES",g.helper.getLocalValue("LAST_QUOTES"),e)})})},g.onNormalStart=function(){R=document.title;for(var e=g.helper.environment.user.name,t="",a=0;e.length>a;a++)t+=e.charCodeAt(a)>255?"\\"+e.charCodeAt(a):e.charAt(a);v="http://www.forocoches.com/foro/search.php?do=process&query="+escape(t)+"&titleonly=0&showposts=1",w=g.helper.getValue("LAST_QUOTES_UPDATE"),x=g.helper.getValue("LAST_READ_QUOTE"),k=g.helper.getValue("LAST_QUOTES"),_=Array(),k&&(_=JSON.parse(k)),b=g.preferences.refreshEvery,"off"!=b&&(b=parseInt(b));var o="quote",r=g.helper.getResourceText("quotehtml");SHURSCRIPT.templater.storeTemplate(o,r),SHURSCRIPT.templater.compile(o),i(),n()};var M={}}(jQuery,SHURSCRIPT.moduleManager.createModule),function(e,t,n){"use strict";function a(){""!==N.preferences.favoritesColor&&(N.preferences.favoritesBorderOnly?GM_addStyle(".favorite>td:nth-child(3) {border-left: 4px solid "+N.preferences.favoritesColor+" !important}"):GM_addStyle(".favorite>td:nth-child(3) {background-color:"+N.preferences.favoritesColor+" !important;}")),GM_addStyle(".fav img {display:none;} .fav {cursor: pointer; background-repeat:no-repeat; background-position: center; background-image:url('"+SHURSCRIPT.config.imagesURL+"fav.png"+"');min-width:20px;}"),GM_addStyle(".shurmenu_trigger img, .shurmenu_opened img {display:none;} .shurmenu_trigger, .shurmenu_opened {cursor: pointer; background-repeat:no-repeat; background-position: center; background-image:url('"+SHURSCRIPT.config.imagesURL+"roto2.gif"+"');min-width:20px;}"),GM_addStyle(".not_fav img {display:none;} .not_fav {cursor: pointer; background-repeat:no-repeat; background-position: center; background-image:url('"+SHURSCRIPT.config.imagesURL+"nofav.png"+"');min-width:20px;}"),GM_addStyle(".shur_estrella {width:30px;vertical-align:middle;} .shur_estrella a {cursor: pointer; width:20px; height:20px; display:block; background-repeat:no-repeat; background-position: center; background-image:url('"+SHURSCRIPT.config.imagesURL+"nofav.png"+"'); margin:0 auto;} .shur_estrella a.fav {background-image:url('"+SHURSCRIPT.config.imagesURL+"fav.png"+"');}"),""!==N.preferences.highlightColor&&(N.preferences.highlightBorderOnly?GM_addStyle(".highlighted>td:nth-child(3) {border-left: 4px solid "+N.preferences.highlightColor+"}"):GM_addStyle(".highlighted>td:nth-child(3) {background-color:"+N.preferences.highlightColor+";}")),GM_addStyle(".highlightKeyword {text-decoration: underline; color: black;}"),GM_addStyle(".hiddenKeyword {text-decoration: line-through; color: black;}")}function o(){v(),b(),e("body").click(function(t){-1==t.target.className.indexOf("popover")&&e(".popover").length&&!jQuery.contains(e(".popover")[0],t.target)&&(e(".shurmenu_opened").not(""!=t.target.id?"#"+t.target.id:"").removeClass("shurmenu_opened"),-1==t.target.id.indexOf("statusicon")&&e(".popover").remove())}),H=JSON.parse(N.helper.getValue("HIDDEN_THREADS","[]")),w(),e("#threadslist tr").each(function(){var t={};t.row=e(this),t.title_td=e(this).find('td[id^="td_threadtitle_"]'),0!=t.title_td.length&&(t.title_link=t.title_td.find('div > a[id^="thread_title_"]').first(),t.href=t.title_link.attr("href"),t.id=parseInt(/.*showthread\.php\?.*t=([0-9]+).*/.exec(t.href)[1]),t.title=t.title_link.html(),t.creator_span=t.title_td.find("div.smallfont > span:last-child"),t.creator=t.creator_span.text(),t.icon_td=e(this).find("#td_threadstatusicon_"+t.id),r(t),t.icon_td.popover({content:l(t),container:"body",placement:"right",html:!0,trigger:"manual"}),t.icon_td.click(function(){e(".popover").remove(),e(this).popover("show"),e(".popover .popover-content").html(l(t)),e(".popover .popover-content").css({height:"30px"}),e(this).addClass("shurmenu_opened")}),t.icon_td.hover(function(){e(this).addClass("shurmenu_trigger")},function(){e(this).removeClass("shurmenu_trigger")}),L.push(t))})}function i(){var t=e("#threadtools_menu form>table tr:last a").attr("href");if(-1!=t.indexOf("subscription"))var n=parseInt(t.replace("subscription.php?do=addsubscription&t=",""),10);else var n=parseInt(t.replace("poll.php?do=newpoll&t=",""),10);var a=E.isFavorite(n),o='<td class="shur_estrella shurscript"><a href="#" class="'+(a?"fav":"")+'" data-placement="top" data-toggle="tooltip"></a></td>';e("#poststop").next().find("td.smallfont").first().before(o),e("#posts").next().find("table td.smallfont").first().before(o),e(".shur_estrella a").tooltip({delay:300,title:a?"Desmarcar como favorito":"Marcar como favorito"}),e(".shur_estrella a").each(function(){e(this).click(function(){return a?(e(this).tooltip("destroy"),e(this).tooltip({delay:300,title:"Marcar como favorito"}),a=!1,E.remove(n),k(),e(".shur_estrella a").each(function(){e(this).removeClass("fav")})):(e(this).tooltip("destroy"),e(this).tooltip({delay:300,title:"Desmarcar como favorito"}),a=!0,E.add(n),E.populateAndSave({id:n}),e(".shur_estrella a").each(function(){e(this).addClass("fav")})),!1})})}function r(t){if("/search.php"==N.helper.environment.page)E.isFavorite(t.id)&&(t.row.addClass("favorite"),t.isFavorite=!0);else{var n;H.indexOf(t.id)>=0?(s(t),t.isHidden=!0):E.isFavorite(t.id)?(t.isFavorite=!0,e(".favorite").not(".hiddenThread").length>0?e(".favorite").not(".hiddenThread").last().after(t.row):e(".highlighted").not(".hiddenThread").length>0?e(".highlighted").not(".hiddenThread").first().before(t.row):e("#threadslist > tbody[id^='threadbits_forum'] > tr").first().before(t.row),t.row.addClass("favorite")):A&&(n=y(t.creator,A,"hiddenKeyword"))?(s(t),t.isHidden=!0,t.isHiddenByUser=!0,t.creator_span.html(n)):M&&(n=y(t.title,M,"hiddenKeyword"))&&(s(t),t.isHidden=!0,t.isHiddenByKeywords=!0,t.title=n,t.title_link.html(n));var a;(I&&(n=y(t.title,I,"highlightKeyword"))||P&&(a=y(t.creator,P,"highlightKeyword")))&&(t.isHighlighted=!0,a?t.creator_span.html(a):t.title_link.html(n),t.isHidden||t.isFavorite||(e(".highlighted").not(".hiddenThread").length>0?e(".highlighted").not(".hiddenThread").last().after(t.row):e(".favorite").not(".hiddenThread").length>0?e(".favorite").not(".hiddenThread").last().after(t.row):e("#threadslist > tbody[id^='threadbits_forum'] > tr").first().before(t.row)),t.row.addClass("highlighted"),t.isHiddenByKeywords&&R.find(".tcat").css("background","#FBBD97")),t.isHidden||-1!=t.icon_td.find("img").attr("src").indexOf("new.gif")||(N.preferences.hideReadThreads&&t.row.css("display","none"),D.push(t))}}function s(t){var n=e("#hiddenthreadslist");if(0==n.length){var a=e("#threadslist");n=e('<table id="hiddenthreadslist" class="tborder" cellspacing="1" cellpadding="5" border="0" width="100%" align="center">'),n.append(a.find("tbody").first().clone());var o=a.prev(),i=e('<table id="hiddenthreadsheader" class="tborder" cellspacing="1" cellpadding="5" border="0" width="100%" align="center" style="cursor: pointer;"><tr><td class="tcat" width="100%"><span style="background: url(\''+SHURSCRIPT.config.imagesURL+'trash-black.png\') no-repeat scroll 0% 0% transparent; height: 16px; display: inline-block; vertical-align: middle; width: 20px; margin-top: -2px;"></span><span id="numhiddenthreads">0</span> Hilo(s) oculto(s)</td></tr></table>');i.click(function(){n.parent().slideToggle()}),o.before(n),n.before(i),n.wrap('<div id="hiddenthreadslistwrapper" style="overflow: hidden;"></div>'),n.parent().hide(),e("#hiddenthreadsheader, #hiddenthreadslistwrapper").wrapAll('<div id="hiddenthreads" style="margin-bottom: 15px;"></div>'),R=e("#hiddenthreads")}t.row.addClass("hiddenThread"),n.append(t.row),U++,1==U&&R.show(),R.find("#numhiddenthreads").html(U)}function l(t){var n=e("<div class='shurscript'/>");return(!t.isHidden||t.isHiddenByKeywords)&&n.append(g(t,"Quitar favorito","Favorito",SHURSCRIPT.config.imagesURL+"star.png",t.isFavorite,function(){c(t),t.icon_td.removeClass("shurmenu_opened"),e(".popover").remove()})),"/search.php"!=N.helper.environment.page&&n.append(g(t,"Mostrar de nuevo","Ocultar",SHURSCRIPT.config.imagesURL+"trash.png",t.isHidden&&!t.isHiddenByKeywords,function(){d(t),t.icon_td.removeClass("shurmenu_opened"),e(".popover").remove()},"btn-danger")),n}function c(e){e.isFavorite?u(e):p(e)}function d(e){e.isHidden?e.row.fadeOut({complete:function(){f(e),e.row.show()}}):e.row.fadeOut({complete:function(){h(e),e.row.show()}})}function p(t){E.add(t.id),E.populateAndSave({id:t.id}),e(t.row).addClass("favorite"),t.isFavorite=!0}function u(t){E.remove(t.id),e(t.row).removeClass("favorite"),t.isFavorite=!1,k()}function h(e){e.isHidden=!0,H.push(e.id),(e.isFavorite||E.isFavorite(e.id))&&u(e),s(e),_()}function f(e){T(e.id,H),e.icon_td.removeClass("shurmenu_opened"),e.isHidden=!1,m(e),_()}function m(t){e("#threadslist > tbody[id^='threadbits_forum']").append(t.row),U--,R.find("#numhiddenthreads").html(U),0==U&&(R.hide(),R.find("#hiddenthreadslistwrapper").hide())}function g(t,n,a,o,i,r,s){var l=e('<button type="button" data-toggle="button" style="margin: 0 5px; display: inline-block;" class="btn btn-sm '+(s?s:"btn-default")+'"><span style="background: url(\''+o+"') no-repeat scroll 0% 0% transparent; height: 16px; display: inline-block; vertical-align: middle; width: 20px; margin-top: -2px;\"></span><span>"+(i?n:a)+"</span></button>");return l.click(function(){var t;t=e(this).hasClass("active")?a:n,e(this).find("span")[0].style.backgroundImage=o,e(this).find("span")[1].innerHTML=t}),i&&l.addClass("active"),l.click(r),l}function v(){var t=e("#stickies_collapse").length?e("#stickies_collapse"):e("#forumtools"),n=e('<a rel="nofollow">'+(N.preferences.hideReadThreads?"Mostrar todos los hilos":"Mostrar solo los hilos no leídos")+"</a>");O=e('<td class="vbmenu_control" nowrap="nowrap" style="cursor: pointer;"></td>'),O.append(n),O.click(function(){N.preferences.hideReadThreads=!N.preferences.hideReadThreads,N.preferences.hideReadThreads?(e.each(D,function(e,t){t.hideRead=!0,t.row.css("display","none")}),n.html("Mostrar todos los hilos")):(e.each(D,function(e,t){t.hideRead=!1,t.row.css("display","table-row")}),n.html("Mostrar solo los hilos no leídos")),N.storePreferences()}),t.before(O)}function b(){var t=e("<input name='quickFilter' placeholder='Filtro rápido...'/>"),n=e("<td class='tcat' style='padding:0px 4px;'/>");n.append(t),"/search.php"==N.helper.environment.page?e("#threadslist .tcat span").last().append(n):O.before(n);var a,o=function(){if(""==t.val()||2>=t.val().length)L.forEach(function(e){e.hideRead||e.row.css("display","table-row"),e.title_link.html(e.title)});else{var e=x(t.val(),!1,!1);L.forEach(function(t){if(!t.isHidden){var n;!t.hideRead&&(n=y(t.title,e,"highlightKeyword"))?(t.title_link.html(n),t.row.css("display","table-row")):(t.title_link.html(t.title),t.row.css("display","none"))}})}};t.keydown(function(e){27==e.which?setTimeout(function(){t.val(""),t.trigger("input")},1):13==e.which&&e.preventDefault()}),t.on("input",function(){clearTimeout(a),a=setTimeout(o,200)})}function y(e,t,n){for(var a=!1,o=t&&t.exec(e),i=e;null!=o&&""!=o[0];)i=i.replace(o[0].trim(),"<span class='"+n+"'>"+o[0].trim()+"</span>"),e=e.substring(o.index+o[0].length),o=t.exec(e),a=!0;return a&&i}function w(){if(N.preferences.hiddenKeywords)try{M=x(N.preferences.hiddenKeywords,N.preferences.hiddenKeywordsIsRegex)}catch(e){M=null,bootbox.alert("Ha ocurrido un error. Revisa la expresión regular que has introducido para ocultar hilos.")}if(N.preferences.hiddenUsers)try{A=x(N.preferences.hiddenUsers,!1)}catch(e){A=null,bootbox.alert("Ha ocurrido un error. Revisa la expresión regular que has introducido para ocultar hilos por usuario.")}if(N.preferences.highlightKeywords)try{I=x(N.preferences.highlightKeywords,N.preferences.highlightKeywordsIsRegex)}catch(e){I=null,bootbox.alert("Ha ocurrido un error. Revisa la expresión regular que has introducido para resaltar hilos.")}if(N.preferences.highlightUsers)try{P=x(N.preferences.highlightUsers,!1)}catch(e){P=null,bootbox.alert("Ha ocurrido un error. Revisa la expresión regular que has introducido para resaltar hilos por usuario.")}}function x(e,t,a){var o;return t?o=RegExp(e,"i"):(e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),e=e.replace(/[\ ]*[\,]+[\ ]*$/,""),o=a===n||a?"(\\b|\\ )":"",o+="("+e.replace(/[aáà]/gi,"[aáà]").replace(/[eéè]/gi,"[eéè]").replace(/[iíï]/gi,"[iíï]").replace(/[oóò]/gi,"[oóò]").replace(/[uúü]/gi,"[uúü]").replace(/[\ ]*[\,]+[\ ]*/g,"|")+")",(a===n||a)&&(o+="(\\b|\\ )"),o=RegExp(o,"i")),o}function k(){N.helper.setValue("FAVORITES",JSON.stringify(E))}function _(){N.helper.setValue("HIDDEN_THREADS",JSON.stringify(H))}function T(e,t){var n=t.indexOf(e);n>-1&&t.splice(n,1)}function C(){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===t.readyState&&200===t.status){for(var n=t.responseText,a=new DOMParser,o=a.parseFromString(n,"text/html"),i=o.getElementById("buddylist").getElementsByTagName("a"),r=[],s=0,l=i.length;l>s;s++)r.push(i[s].textContent);var c=r.join(", "),d=e("input[data-maps-to='highlightUsers']").tokenfield("getTokensList",",");r.length>0?d?c!==d?bootbox.confirm("<p>La lista actual se sobreescribirá con el nuevo listado que se obtenga de tu <a href='/foro/profile.php?do=buddylist' target='_blank'>lista de contactos</a>.</p><p>¿Desea continuar?</p>",function(t){t&&e("input[data-maps-to='highlightUsers']").tokenfield("setTokens",c)}):bootbox.alert("No hemos detectado cambios en tu <a href='/foro/profile.php?do=buddylist' target='_blank'>lista de contactos</a> desde la última importación. Realiza cambios en tus contactos antes de volver a intentarlo."):e("input[data-maps-to='highlightUsers']").tokenfield("setTokens",c):bootbox.alert("Tu <a href='/foro/profile.php?do=buddylist' target='_blank'>lista de contactos</a> está vacía. Para resaltar los mensajes de tus contactos... ¡primero añade algunos!")}},t.open("GET","/foro/profile.php?do=buddylist",!0),t.send()}function S(){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===t.readyState&&200===t.status){var n=t.responseText,a=new DOMParser,o=a.parseFromString(n,"text/html"),i=o.getElementById("ignorelist");if(i){for(var r=i.getElementsByTagName("a"),s=[],l=0,c=r.length;c>l;l++)s.push(r[l].textContent);var d=s.join(", "),p=e("input[data-maps-to='hiddenUsers']").tokenfield("getTokensList",",");s.length>0&&(p?d!==p?bootbox.confirm("<p>La lista actual se sobreescribirá con el nuevo listado que se obtenga de tu <a href='/foro/profile.php?do=ignorelist' target='_blank'>lista de ignorados</a>.</p><p>¿Desea continuar?</p>",function(t){t&&e("input[data-maps-to='hiddenUsers']").tokenfield("setTokens",d)}):bootbox.alert("No hemos detectado cambios en tu <a href='/foro/profile.php?do=ignorelist' target='_blank'>lista de ignorados</a> desde la última importación. Realiza cambios en tus ignorados antes de volver a intentarlo."):e("input[data-maps-to='hiddenUsers']").tokenfield("setTokens",d))}else bootbox.alert("Tu <a href='/foro/profile.php?do=ignorelist' target='_blank'>lista de ignorados</a> está vacía. Para ocultar los posts de tus usuarios ignorados... ¡primero ignora a alguien!")}},t.open("GET","/foro/profile.php?do=ignorelist",!0),t.send()}var E,R,O,M,A,I,P,N=t({id:"FilterThreads",name:"Filtrado de hilos",author:"xusoO",version:"0.2",description:"Añade varias opciones a la lista de hilos de un subforo: Marcar hilos como favoritos, resaltarlos, u ocultar los temas que no te interesen. Ya sea de forma manual o automática mediante palabras clave.",domain:["/forumdisplay.php","/showthread.php","/search.php"],initialPreferences:{enabled:!0,hideReadThreads:!1,hiddenUsers:"",hiddenKeywords:"",hiddenKeywordsIsRegex:!1,highlightUsers:"",highlightKeywords:"",highlightKeywordsIsRegex:!1,highlightColor:"#FAF7DD",highlightBorderOnly:!1,favoritesColor:"#D5E6EE",favoritesBorderOnly:!1}}),$=function(t){var a=this;if(this.favs=[],this.isFavorite=function(e){var t;if("number"==typeof e)t=e;else{if(e.id===n)return!1;t=e.id}for(var o=0;a.favs.length>o;o++)if(a.favs[o].id==t)return!0;return!1},this.add=function(e){var t={};"number"==typeof e?t.id=e:t=e,a.favs.push(t)},this.remove=function(e){var t;"number"==typeof e?t=e:e.id!==n&&(t=e.id);for(var o=0;a.favs.length>o;o++)if(a.favs[o].id==t){a.favs.splice(o,1);break}},this.update=function(e){for(var t=0;a.favs.length>t;t++)a.favs[t].id==e.id&&(a.favs[t]=e)},this.getSections=function(){for(var e=[],t=0;a.favs.length>t;t++)if(a.favs[t].section!=n){for(var o=!1,i=0;e.length>i;i++)if(a.favs[t].section.id==e[i].id){o=!0;break}o||e.push(a.favs[t].section)}return e},this.populateAndSave=function(t,o){e.ajax({url:"/foro/showthread.php?t="+t.id,dataType:"text"}).done(function(i){var r=e(i).find("div.page td.thead span.cmega").html();r=r.replace("<!-- google_ad_section_start -->",""),r=r.replace("<!-- google_ad_section_end -->","");var s=e(i).find(".bigusername").first().html(),l=e(i).find(".navbar").last().find("a").html(),c=e(i).find(".navbar").last().find("a").attr("href").replace("forumdisplay.php?f=","");t.title=r,t.author=s,t.section={name:l,id:c},a.update(t),k(),o!=n&&o(t)})},this.getFavHTML=function(e){var t='<tr id="shurscript-fav-'+e.id+'">'+'<td style="vertical-align:middle;"><a id="'+e.id+'" style="cursor:pointer;"><img src="'+SHURSCRIPT.config.imagesURL+'trash-black.png" style="width:16px;height:16px;" /></a></td>'+'<td><a href="{link}">{title}</a> <a href="{link}&goto=newpost" class="lastpost-tooltip" data-placement="bottom" data-toggle="tooltip" title="Ir al último mensaje leído">»</a></td>'+'<td style="text-align:center;vertical-align:middle;"><span class="badge" style="font-size:10px;">{author}</span></td></tr>';return t=e.hasOwnProperty("title")?t.replace("{title}",e.title):t.replace("{title}","Cargando datos del hilo..."),t=e.hasOwnProperty("author")?t.replace("{author}",e.author):t.replace("{author}","---"),t=t.replace(/\{link\}/g,"/foro/showthread.php?t="+e.id)},this.getSectionHTML=function(t){var n='<table class="table table-striped table-bordered" style="margin-bottom: 0;"><th></th><th style="text-align:center;font-size:12px;">Hilo</th><th style="text-align:center;font-size:12px;">Autor</th></table>',a=e('<div class="panel panel-default" id="shurscript-favs-section-'+t.id+'">'+'<div class="panel-heading"><h4 class="panel-title"><a data-toggle="collapse" data-parent="#accordion" href="#collapse-'+t.id+'">'+t.name+"</a></h4></div>"+'<div id="collapse-'+t.id+'" class="panel-collapse collapse">'+'<div class="panel-body">'+n+"</div>"+"</div>"+"</div>");return a},t.favs!==n)a.favs=t.favs;else for(var o=0;t.length>o;o++)this.add(t[o])},L=[],D=[],H=[],U=0;N.migrateValues=function(e){N.helper.setValue("FAVORITES",N.helper.getLocalValue("FAVORITES"),function(){N.helper.setValue("HIDDEN_THREADS",N.helper.getLocalValue("HIDDEN_THREADS"),e)})},N.normalStartCheck=function(){return!0},N.onNormalStart=function(){a(),E=new $(JSON.parse(N.helper.getValue("FAVORITES","[]"))),"/forumdisplay.php"==N.helper.environment.page||"/search.php"==N.helper.environment.page?o():"/showthread.php"==N.helper.environment.page&&i()},N.getPreferenceOptions=function(){var e=N.helper.createPreferenceOption,t=function(){C()
},n=function(){S()};return"function"==typeof exportFunction?(exportFunction(t,unsafeWindow,{defineAs:"FilterThreads_importBuddyList"}),exportFunction(n,unsafeWindow,{defineAs:"FilterThreads_importIgnoreList"})):(unsafeWindow.FilterThreads_importBuddyList=t,unsafeWindow.FilterThreads_importIgnoreList=n),[e({type:"header",caption:"Ocultar hilos",subCaption:"Puedes ocultar hilos de forma automática, ya sea mediante una lista negra de usuarios o por palabras clave en el título de los temas:"}),e({type:"checkbox",mapsTo:"hideReadThreads",caption:"Mostrar solo hilos no leídos.",subCaption:'<span style="color:gray;">De cualquier modo aparecerá un botón para ocultarlos o mostrarlos. Esta opción solo cambia el comportamiento por defecto.</span>'}),e({type:"tags",mapsTo:"hiddenUsers",caption:"Ignorar hilos por usuario <b>(separados por comas)</b>",buttons:!0,plain:!0,button1:'<a href="#" onclick="FilterThreads_importIgnoreList(); return false;" class="btn btn-xs btn-default">Importar de la lista de ignorados</a>'}),e({type:"text",mapsTo:"hiddenKeywords",caption:"Ignorar hilos por palabras clave <b>(separadas por comas)</b>"}),e({type:"header",caption:"Resaltar hilos",subCaption:"Los hilos que contengan cualquiera de estas palabras serán resaltados con los colores selccionados de entre el resto de hilos:"}),e({type:"tags",mapsTo:"highlightUsers",caption:"Resaltar hilos por usuario <b>(separados por comas)</b>",buttons:!0,plain:!0,button1:'<a href="#" onclick="FilterThreads_importBuddyList(); return false;" class="btn btn-xs btn-default">Importar de la lista de contactos</a>'}),e({type:"text",mapsTo:"highlightKeywords",caption:"Resaltar hilos por palabras clave <b>(separadas por comas)</b>"}),e({type:"color",mapsTo:"highlightColor",caption:"Color",subCaption:'El color de fondo para los hilos resaltados. Por defecto <span class="badge">'+N.initialPreferences.highlightColor+"</span>"}),e({type:"checkbox",mapsTo:"highlightBorderOnly",caption:"Aplicar color solo al borde izquierdo"}),e({type:"header",caption:"Hilos favoritos",subCaption:"Mostrará un icono al lado de cada hilo para marcarlo como favorito. Los hilos favoritos destacarán entre los demás cuando el usuario entre a algún subforo:"}),e({type:"color",mapsTo:"favoritesColor",caption:"Color",subCaption:'Color de fondo", "El color de fondo para los hilos favoritos. Por defecto <span class="badge">'+N.initialPreferences.favoritesColor+"</span>"}),e({type:"checkbox",mapsTo:"favoritesBorderOnly",caption:"Aplicar color solo al borde izquierdo"})]},N.onShurbarClick=function(){E==n&&(E=new $(JSON.parse(N.helper.getValue("FAVORITES","[]"))));var t=e('<div id="shurscript-favs" class="shurscript modal fade" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true"><div class="modal-dialog modal-favs"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="modalLabel">Hilos Favoritos</h4></div><div class="modal-body panel-group" id="accordion"></div></div></div></div>');e("body").append(t);var a=E.getSections();a.forEach(function(e){t.find(".modal-body").append(E.getSectionHTML(e))});try{var o=location.href.match(/forumdisplay\.php\?f\=(\d+)/i),i=o&&o[1];i||(i=e(".fjsel").val());var r=e("#shurscript-favs #shurscript-favs-section-"+i+" .collapse");r.length||(r=e("#shurscript-favs .collapse").first()),r.collapse("show")}catch(s){}for(var l,c=0;E.favs.length>c;c++)if(l=E.favs[c],"title"in l&&"section"in l&&"author"in l){var d=e("#shurscript-favs-section-"+l.section.id+" table");d.append(E.getFavHTML(l)),d.find("#shurscript-fav-"+l.id+" a#"+l.id).click(function(){var t=e(this).attr("id");bootbox.confirm("Por favor, confirme que desea eliminar este hilo de sus favoritos",function(e){e&&(bootbox.hideAll(),N.favRemove(t))})})}else E.populateAndSave(l,N.favPopulated);E.favs.length||(t.find(".modal-body").css("text-align","center"),t.find(".modal-body").html('<span style="color: gray; font-size: 14pt; display: inline-block; font-weight: 200; margin-bottom: 10px;">Todav&iacute;a no has a&ntilde;adido ning&uacute;n hilo como favorito :(</span><img src="'+SHURSCRIPT.config.imagesURL+"howtofav.gif"+'">')),t.on("hidden.bs.modal",function(){t.remove()}),t.find(".lastpost-tooltip").tooltip({delay:300}),t.modal("show"),t.css("z-index",1e3),e(".modal-backdrop").css("z-index",999)},N.favPopulated=function(t){var n=e("#shurscript-favs");if(n.length>0){var a=e("#shurscript-favs-section-"+t.section.id);0>=a.length&&(a=e(E.getSectionHTML(t.section)),n.find(".modal-body").append(a),n.find(".lastpost-tooltip").tooltip({delay:300})),a.find("table").append(E.getFavHTML(t)),a.find("#shurscript-fav-"+t.id+" a#"+t.id).click(function(){var t=e(this).attr("id");bootbox.confirm("Por favor, confirme que desea eliminar este hilo de sus favoritos",function(e){e&&(bootbox.hideAll(),N.favRemove(t))})})}},N.favRemove=function(t){t=parseInt(t),E.remove(t),k(),e("#shurscript-fav-"+t).remove()},N.shurbarIcon=function(){return{name:"Hilos favoritos",description:"Ver la lista de todos tus hilos favoritos",image:SHURSCRIPT.config.imagesURL+"star.png",actionType:"popover",handler:N.onShurbarClick}}}(jQuery,SHURSCRIPT.moduleManager.createModule),function(e,t){"use strict";function n(){var t=m();v()||e("#"+t.editorid+"_textarea").css("width",600),unsafeWindow.switch_editor_mode(t.editorid),unsafeWindow.is_saf=!1,unsafeWindow.is_moz=!0,t.wysiwyg_mode=1,0==e("#"+t.editorid+"_cmd_switchmode").length&&e('<td><div id="'+t.editorid+'_cmd_switchmode" class="imagebutton" style="background: none repeat scroll 0% 0% rgb(225, 225, 226); color: rgb(0, 0, 0); padding: 1px; border: medium none;"><img height="20" width="21" alt="Cambiar Modo de Editor" src="http://cdn.forocoches.com/foro/images/editor/switchmode.gif" title="Cambiar Modo de Editor"></div></td>').insertAfter(e("#vB_Editor_QR_cmd_resize_0_99").parent())}function a(){SHURSCRIPT.eventbus.triggerDelayed("editorReady",0),v()&&R.preferences.multiQuickReply&&s(),R.preferences.autoGrow&&r(),R.preferences.savePosts&&c(),R.preferences.autoSendReply&&d(),v()&&e("a[href^='editpost.php?do=editpost']").click(function(){var t=setInterval(function(){var n="vB_Editor_QE_"+unsafeWindow.vB_QuickEditor.editorcounter;if(e("#"+n+"_editor").length>0&&T[n]){clearInterval(t);var a=T[n];0==a.wysiwyg_mode?(unsafeWindow.switch_editor_mode(n),a.wysiwyg_mode=1,t=setInterval(function(){T[n].editdoc.body&&(clearInterval(t),i(n))},500)):i(n)}},500)})}function o(){v()&&p(),e("input[name='sbutton'], input[name='preview']").on("click",function(){var e=y();e=e.replace(/<div>((?!<\/div>)(?!<div>).)*<\/div>/gi,function(e){var t=e.substring(5,e.length-6);return"<br>"==t?t:"<br>"+t}),w(e),h()})}function i(t){var n=T[t];if(R.preferences.autoGrow){try{-1!=navigator.userAgent.indexOf("AppleWebKit")&&n.editdoc.write("<!doctype HTML>\n"+n.editdoc.head.outerHTML+n.editdoc.body.outerHTML)}catch(a){}e(n.editdoc.body).on("input",function(){n.editbox.style.height=Math.max(n.editdoc.body.offsetHeight+30,200)+"px"}),e(n.editdoc.body).trigger("input")}}function r(){var t=m();try{-1!=navigator.userAgent.indexOf("AppleWebKit")&&t.editdoc.write("<!doctype HTML>\n"+t.editdoc.head.outerHTML+t.editdoc.body.outerHTML)}catch(n){}S=e('<input type="checkbox" checked/>')[0],S.onclick=function(){S.checked?h():t.editbox.style.height=E+"px"},e(t.controlbar).find("> table > tbody > tr").first().append("<td></td>").append(S),S.title="Crecer automáticamente con el contenido",E=v()?f():unsafeWindow.fetch_cookie("editor_height")||430,e(g()).on("input",function(){S.checked&&h()}),e("#vB_Editor_QR_cmd_resize_1_99").click(function(){S.checked=!1,h()}),e("#vB_Editor_QR_cmd_resize_0_99").click(function(){S.checked=!1,h()}),h()}function s(){var t=function(){if(b()){var t=this.id.replace("qr_",""),n="",a=!1,o=unsafeWindow.fetch_cookie("vbulletin_multiquote");if(o&&""!=o&&(o=o.split(","),o.forEach(function(o){if(t==o&&(a=!0),0!=e("#post"+o).length){n+=l(o);var i=e('img[id^="mq_'+o+'"]');i.attr("src",i.attr("src").replace("_on.gif","_off.gif"))}})),a||(n+=l(t)),n+="<br>",_(y())){var i=R.preferences.postOverwrite;switch(i){case"ASK":bootbox.dialog({message:"Actualmente hay texto escrito en el editor <b>¿Quieres añadir la cita al texto actual o sobreescribirlo?</b>",buttons:[{label:"Cancelar",className:"btn-default"},{label:"Añadir",className:"btn-primary",callback:function(){x(n),h()}},{label:"Sobreescribir",className:"btn-danger",callback:function(){w(""),x(n),h()}}]});break;case"OVERWRITE":w(""),x(n),h();break;case"APPEND":x(n),h()}}else x(n),h();unsafeWindow.set_cookie("vbulletin_multiquote","")}};e("body").on("click",'a[id^="qr_"]',t),e("#"+m().editorid).siblings().filter("fieldset").first().hide()}function l(t){var n=e("#post"+t).find(".bigusername").text(),a=e("#post_message_"+t).clone();return a.find("div[style*='margin:20px; margin-top:5px;']").remove(),a.find("div[style='margin:20px; margin-top:5px'] > .smallfont:contains('Código')").parent().each(function(){var t=e(this).find(".alt2"),n=e(this).find(".smallfont").text();return"Código HTML:"==n?(t.find("span").each(function(){var t=this.nextSibling&&0==this.nextSibling.textContent.indexOf("\n")?"</br>":"";this.outerHTML=e(this).text().replace(/</g,"&lt;")+t}),t=t.html().replace(/ /g,"&nbsp;"),e(this).replaceWith("[HTML]</br>"+t.trim()+"</br>[/HTML]"),undefined):"Código PHP:"==n?(t=t.find("code span"),t.find("span").each(function(){this.outerHTML=this.innerHTML}),t=t.html().replace(/ /g,"&nbsp;"),e(this).replaceWith("[PHP]</br>"+t.trim()+"</br>[/PHP]"),undefined):(t=t.text(),t=t.replace(/\n/g,"</br>").replace(/\ /g,"&nbsp;"),"Código:"==n&&e(this).replaceWith("[CODE]</br>"+t.trim()+"</br>[/CODE]"),undefined)}),a.find("iframe.youtube-player").each(function(){var t=e(this).attr("src").match(/^.*\/(.*)/)[1];e(this).replaceWith("[YOUTUBE]"+t+"[/YOUTUBE]")}),a.find('img[class!="inlineimg"]').each(function(){e(this).replaceWith("[IMG]"+e(this).attr("src")+"[/IMG]")}),"[QUOTE="+n+";"+t+"]"+a.html().trim()+"[/QUOTE]"+"<br><br>"}function c(){var t=e('input[name="t"]').val();t||"/newthread.php"!=R.helper.environment.page||(t="new_thread");var n=R.helper.getValue("POST_BACKUP");n&&v()&&(n=JSON.parse(n),n.threadId==t&&(!_(y())&&_(n.postContents)&&w(n.postContents),h()));var a,o=function(){clearTimeout(a),a=setTimeout(function(){R.helper.setValue("POST_BACKUP",JSON.stringify({threadId:t,postContents:y()}))},1e3)};if(e(g()).on("input",o),v())e("input[name='sbutton']").on("click",function(){clearTimeout(a),R.helper.deleteValue("POST_BACKUP")});else{var i=e("input[name='sbutton']");i.attr("type","button");var r=i.parents("form")[0];i.on("click",function(){clearTimeout(a),r.onsubmit()&&R.helper.deleteValue("POST_BACKUP",function(){r.submit()})})}}function d(){var t=function(){var t;unsafeWindow.autoReplyInterval&&clearInterval(unsafeWindow.autoReplyInterval);var n=setInterval(function(){var a=e("td.alt1 ol");a.length>0&&-1!=a.text().indexOf("Debes esperar")?(a=a.find("li").first(),t=t||parseInt(a.text().match(/en ([\d]+)/)[1]),0>=t--?(clearInterval(n),R.preferences.savePosts&&R.helper.deleteValue("POST_BACKUP"),document.getElementsByName("vbform")[0].submit()):a.html("Debes esperar al menos 30 segundos entre cada envio de nuevos mensajes. El mensaje se enviará automáticamente en "+t+" segundos. <a style='color: #CC3300;cursor:pointer;' onclick='clearInterval(autoReplyInterval); this.remove();'>Cancelar</a>")):clearInterval(n)},1e3);unsafeWindow.autoReplyInterval=n};v()?e("input[name='sbutton']").on("click",t):t()}function p(){C=function(e){e=unsafeWindow.do_an_e(e),"click"==e.type&&T[m().editorid].format(e,this.cmd,!1,!0),T[m().editorid].button_context(this,e.type)};var t=e(m().controlbar).find("> table > tbody > tr > td:nth-child(8)"),n=[];n.push(u("justifyleft","Alinear a la Izquierda")),n.push(u("justifycenter","Alinear al Centro")),n.push(u("justifyright","Alinear a la Derecha")),n.push('<td><img width="6" height="20" alt="" src="http://cdn.forocoches.com/foro/images/editor/separator.gif"></td>'),n.push(u("insertorderedlist","Lista Ordenada")),n.push(u("insertunorderedlist","Lista sin Ordenar")),n.push('<td><img width="6" height="20" alt="" src="http://cdn.forocoches.com/foro/images/editor/separator.gif"></td>'),n.push(u("undo","Deshacer")),n.push(u("redo","Rehacer")),n.push('<td><img width="6" height="20" alt="" src="http://cdn.forocoches.com/foro/images/editor/separator.gif"></td>'),n.push(u("wrap0_code","Envolver Etiquetas [CODE]","code")),n.push(u("wrap0_html","Envolver Etiquetas [HTML]","html")),n.push(u("wrap0_php","Envolver Etiquetas [PHP]","php")),n.push('<td><img width="6" height="20" alt="" src="http://cdn.forocoches.com/foro/images/editor/separator.gif"></td>'),t.after(n)}function u(t,n,a){var o=a?a:t,i=e('<div id="vB_Editor_001_cmd_'+t+'" class="imagebutton" style="background: none repeat scroll 0% 0% rgb(225, 225, 226); color: rgb(0, 0, 0); padding: 1px; border: medium none;"><img width="21" height="20" alt="'+n+'" src="http://cdn.forocoches.com/foro/images/editor/'+o+'.gif" title="'+n+'"></div>')[0];return i.editorid=m().editorid,i.cmd=t,i.onclick=i.onmousedown=i.onmouseover=i.onmouseout=C,e("<td></td>").append(i)}function h(){S&&S.checked&&(m().editbox.style.height=Math.min(600,Math.max(f()+30,E))+"px")}function f(){var e=g().offsetHeight;return Math.max(e,100)}function m(){return"/showthread.php"==R.helper.environment.page?T.vB_Editor_QR:T.vB_Editor_001}function g(){return("/showthread.php"==R.helper.environment.page?e("#vB_Editor_QR_iframe"):e("#vB_Editor_001_iframe")).get(0).contentDocument.body}function v(){return"vB_Editor_QR"==m().editorid}function b(){try{return g()}catch(e){return!1}}function y(){return m().get_editor_contents()}function w(e){k(),m().set_editor_contents(e)}function x(e){k(),m().insert_text(e)}function k(){g().focus()}function _(e){return e.trim().replace(/\<br\>/g,"")}var T,C,S,E,R=t({id:"BetterPosts",name:"Editor de posts mejorado",author:"xus0",version:"0.2",description:"Activa varias opciones nuevas en la creación de posts e hilos, tanto el de respuesta rápida como el avanzado. <b>BETA</b>",domain:["/showthread.php","/newthread.php","/newreply.php","/editpost.php"],initialPreferences:{enabled:!0,autoGrow:!0,multiQuickReply:!0,autoSendReply:!0,savePosts:!0,postOverwrite:"ASK"}});R.normalStartCheck=function(){return!0},R.onNormalStart=function(){if(T=unsafeWindow.vB_Editor,o(),b())a();else{n();var e=setInterval(function(){g()&&(clearInterval(e),a())},500)}},R.getPreferenceOptions=function(){var e=R.helper.createPreferenceOption;return[e({type:"checkbox",mapsTo:"autoGrow",caption:"La caja de texto crece a medida que se va escribiendo el post"}),e({type:"checkbox",mapsTo:"multiQuickReply",caption:"Permitir multi-cita con el botón de Respuesta rápida (y mostrar la propia cita en la caja de texto)"}),e({type:"checkbox",mapsTo:"autoSendReply",caption:"Auto-enviar el mensaje pasados los 30 segundos de espera entre post y post"}),e({type:"checkbox",mapsTo:"savePosts",caption:"Guardar copia de los mensajes sin enviar para evitar perder el contenido de un post accidentalmente"}),e({type:"radio",elements:[{value:"ASK",caption:"Preguntar"},{value:"APPEND",caption:"Añadir"},{value:"OVERWRITE",caption:"Sobreescribir"}],caption:"Cuando cites con respuesta rápida y haya texto escrito en el editor ¿Quieres añadir la cita al texto actual o sobreescribirlo?:",mapsTo:"postOverwrite"})]}}(jQuery,SHURSCRIPT.moduleManager.createModule),function(e,t){"use strict";var n=t({id:"Scrollers",name:"Scroll arriba y abajo",author:"xusoO",version:"0.1",description:"Aparecerán dos flechas en la parte inferior del foro; una para volver al principio de la página y la otra para ir al final.",domain:"ALL",initialPreferences:{enabled:!1,upOrDown:"both",side:"center"}});n.normalStartCheck=function(){return!0},n.onNormalStart=function(){"center"!=n.preferences.side?GM_addStyle("#scrollers {opacity: 0.5;bottom: 5px;"+n.preferences.side+": 13px;position: fixed;}"):GM_addStyle("#scrollers {opacity: 0.5;bottom: 5px;left: calc(50% - 55px);position: fixed;}"),GM_addStyle("#scrollers:hover {opacity: 0.9;}"),GM_addStyle('.scrollerArrow {background: url("'+SHURSCRIPT.config.imagesURL+'scroller.png") no-repeat scroll 0 0 transparent;background-size: 50px;cursor: pointer;height: 50px;width: 50px;display: inline-block;margin: 5px;opacity: 0.4;}'),GM_addStyle(".scrollerArrow:hover {opacity: 0.7;}"),GM_addStyle(".scrollerArrow#scrollToBottomArrow {transform: rotate(180deg);-webkit-transform: rotate(180deg);}");var t=e("<div id='scrollers'></div>"),a=e("<div class='scrollerArrow' id='scrollToTopArrow'></div>");a.click(function(){e("html, body").stop().animate({scrollTop:"0px"},800)});var o=e("<div class='scrollerArrow' id='scrollToBottomArrow'></div>");o.click(function(){e("html, body").stop().animate({scrollTop:(e("#qrform").length>0?e("#qrform").offset().top:e("html").height())+"px"},800)}),"up"==n.preferences.upOrDown?t.append(a):"down"==n.preferences.upOrDown?t.append(o):t.append(a).append(o),e(document.body).append(t)},n.getPreferenceOptions=function(){var e=n.helper.createPreferenceOption;return[e({type:"radio",elements:[{value:"both",caption:"Ambas fechas"},{value:"up",caption:"Solo la de ir al principio"},{value:"down",caption:"Solo la de ir al final"}],caption:"Mostrar:",mapsTo:"upOrDown"}),e({type:"radio",elements:[{value:"left",caption:"A la izquierda"},{value:"right",caption:"A la derecha"},{value:"center",caption:"Centradas"}],caption:"Alinear:",mapsTo:"side"})]}}(jQuery,SHURSCRIPT.moduleManager.createModule),function(e,t,n){"use strict";function a(){var t=e("#vB_Editor_001_textarea");if(t!=n){var a=document.evaluate("//*[@id='vB_Editor_001_smiliebox']",document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,o=document.createElement("fieldset");o.title="ShurScript",o.style.marginBottom="10px";var r=document.createElement("legend");r.innerHTML="ShurScript",a.parentNode.insertBefore(o,a),o.appendChild(r);var s=document.createElement("input");s.className="button",s.type="BUTTON",s.style.cursor="pointer",s.addEventListener("click",i,!1),s.setAttribute("id","butNestQuote"),s.value=p,o.appendChild(s)}}function o(e,t){var n=jQuery("#butNestQuote"),a=jQuery("#vB_Editor_001_textarea");n.attr("disabled",!e),a.attr("disabled",!e),n.val(t)}function i(){var e=jQuery("#vB_Editor_001_textarea");o(!1,"Trabajando...");var t=e.val().toUpperCase();if(f=t.search(m),f>=0){var n=f+7;for(g="\n",f=t.indexOf("]",f)+1;" "==t.substr(f,1)||"	"==t.substr(f,1)||"\n"==t.substr(f,1);)"\n"==t.substr(f,1)&&(g=""),f++;for(;"[QUOTE="==t.substr(f,7)&&t.indexOf(";",f)>0&&t.indexOf("]",f)>t.indexOf(";",f);)for(g="\n",n=f+7,f=t.indexOf("]",f)+1;" "==t.substr(f,1)||"	"==t.substr(f,1)||"\n"==t.substr(f,1);)"\n"==t.substr(f,1)&&(g=""),f++;n=t.indexOf(";",n)+1,v=t.substring(n,t.indexOf("]",n));var a=h+"showpost.php?p="+v;d=new XMLHttpRequest,d.onreadystatechange=r,d.open("GET",a,!0),d.send(null)}else o(!0,"Anidar cita"),bootbox.alert(u+"no se han encontrado citas para anidar.")}function r(){if(4==d.readyState){var e=!0,t="";if(200!=d.status&&0>d.responseText.indexOf('id="post_message_'+v+'"')&&(e=!1),e){var n=document.createElement("div");n.innerHTML=d.responseText,t=document.evaluate("//div[@id='post_message_"+v+"']//img[@alt='Ver Mensaje']/..",n,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,null==t?e=!1:t=t.href,n.innerHTML=""}if(e){var a=t.match(/[?&]p=\d+/);null==a?e=!1:t=a[0].substr(3)}if(e){var i=jQuery("#butNestQuote");i.value="Citando...";var r=h+"newreply.php?do=newreply&p="+t;d=new XMLHttpRequest,d.onreadystatechange=l,d.open("GET",r,!0),d.send(null)}e||(o(!0,"Anidar cita"),null==t?bootbox.alert(u+"El mensaje no posee ninguna cita o ya ha sido citado."):bootbox.alert("No se ha podido obtener el post original (status="+d.status+").\nForoCoches podría estar caído. ¡Guarda una copia del mensaje!"))}}function s(e){var t=document.createElement("div");t.innerHTML=e;var n=t.childNodes[0].nodeValue;return t.removeChild(t.firstChild),n}function l(){if(4==d.readyState){var e=!0,t="";if(200!=d.status&&0>d.responseText.indexOf('id="vB_Editor_001_textarea"')&&(e=!1),e){var n=d.responseText.indexOf('id="vB_Editor_001_textarea"'),a=-1;n>=0&&(n=d.responseText.indexOf("[QUOTE",n)),n>=0&&(a=d.responseText.indexOf("[/QUOTE]",n)),0>n?e=!1:t=d.responseText.substring(n,a)+"\n[/QUOTE]"}if(e){var i=jQuery("#vB_Editor_001_textarea");i.val(i.val().substr(0,f)+g+s(t)+"\n"+i.val().substr(f));try{var r=jQuery("#vB_Editor_001_iframe")[0].contentWindow.document.getElementsByClassName("wysiwyg")[0];r.innerHTML=r.innerHTML.replace(/\n/g,""),r.innerHTML=r.innerHTML.replace(/\[QUOTE.*\].*\[\/QUOTE\]/,i.val().substr(0,f)+g+"\n"+i.val().substr(f))}catch(l){}}o(!0,"Anidar cita"),e||null==quoteid&&bootbox.alert("No se ha podido obtener el post original (status="+d.status+").\nForoCoches podría estar caído. ¡Guarda una copia del mensaje!")}}var c=t({id:"NestedQuotes",name:"Citas anidadas",author:"Fritanga",version:"0.1",description:"Permite ir anidando citas hacia arriba hasta el post original",domain:["/newreply.php"],initialPreferences:{enabled:!0}}),d=null,p="Anidar cita",u="No se pudo anidar la cita: ",h=document.URL.substr(0,document.URL.indexOf("newreply.php")),f=-1,m=/\[QUOTE=[^;\]]+;/,g="\n",v=null;c.normalStartCheck=function(){return!0},c.onNormalStart=function(){a()}}(jQuery,SHURSCRIPT.moduleManager.createModule),function(e,t){"use strict";var n=t({id:"BottomNavigation",name:"Barra de navegación duplicada debajo",author:"TheBronx + Fritanga",version:"1.0",description:"Copia la tabla con la navegación a la parte inferior del foro.",domain:["/showthread.php","/newreply.php"]});n.normalStartCheck=function(){return!0},n.onNormalStart=function(){e("#qrform").before('<table width="100%" cellspacing="1" cellpadding="5" border="0" align="center" class="tborder navigation-bot">'+e(".page>div>table").html()+"</table><br>"),e(".navigation-bot .notifications").parent().remove();var t=e(".fjsel").closest("table.tborder"),n=t.find("div.smallfont").parent();e(".tborder.navigation-bot .alt1").after(n),n.addClass("alt1"),t.remove()}}(jQuery,SHURSCRIPT.moduleManager.createModule),function(e,t){"use strict";function n(){"http://www.forocoches.com/foro/search.php?do=process"===location.href?document.getElementById("searchform").submit():location.href+="&ts="+(new Date).getTime()}function a(){r.textContent="Debes esperar al menos "+l+" segundos entre cada búsqueda. Faltan aún "+s+" segundos. [ Recarga automática desactivada ]",c&&clearTimeout(c)}function o(){s--;var e;s>0?(e=document.createElement("a"),e.href="#",e.textContent="Cancelar",e.onclick=function(){return a(),!1},r.textContent="Debes esperar al menos "+l+" segundos entre cada búsqueda. Faltan aún "+s+" segundos. — ",r.appendChild(e),c=setTimeout(o,1e3)):(e=document.createElement("a"),e.href="#",e.textContent="Refrescar",e.onclick=function(){return n(),!1},r.textContent="Cargando… — ",r.appendChild(e),n())}var i=t({id:"RefreshSearch",name:"Actualizar búsquedas en espera",author:"Electrosa",version:"0.2",description:"Recarga automáticamente las búsquedas en las que el sistema obliga a esperar varios segundos, evitando así tener que actualizar manualmente la página.",domain:["/search.php"],initialPreferences:{enabled:!0},preferences:{}});i.normalStartCheck=function(){return-1!==location.href.indexOf("/search.php?do=")};var r,s,l,c;i.onNormalStart=function(){r="ForoCoches"===document.title?document.getElementsByClassName("panel")[0].childNodes[1].childNodes[3]:document.querySelector("td.alt1 ol li");var e=r.textContent,t=e.indexOf("segundos");if(-1!==t){l=~~e.substring(t-3,t),t=e.indexOf("segundos",t+1),s=~~e.substring(t-3,t);var n=performance.timing.responseStart,a=n+1e3*s,i=a-new Date;c=setTimeout(o,i%1e3),s=~~(i/1e3)}}}(jQuery,SHURSCRIPT.moduleManager.createModule),function(e,t,n){"use strict";function a(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===t.readyState&&200===t.status){var e=t.responseText,n=new DOMParser,a=n.parseFromString(e,"text/html");d=o(a.querySelector("#posts div.page")),sessionStorage["op_"+l]=d,i()}},t.open("GET","showthread.php?t="+e,!0),t.send()}function o(e){var t;return(t=e.getElementsByClassName("bigusername")[0])?t.innerHTML:(t=e.querySelector("td.alt2 > a"))?t.innerHTML:null}function i(e){if(!d)return console_log("ERROR"),n;var t=s.helper.environment.user.name,a=s.preferences.contacts.split(/\s*,\s*/);GM_addStyle(".op_post, .op_quote { border: 1px solid "+s.preferences.opPostsColor+" !important; border-left: 5px solid "+s.preferences.opPostsColor+" !important; } .op_post td.alt2 { width: 171px; }"),GM_addStyle(".my_post, .my_quote { border: 1px solid "+s.preferences.myPostsColor+" !important; border-left: 5px solid "+s.preferences.myPostsColor+" !important; } .my_post td.alt2 { width: 171px; }"),GM_addStyle(".contacts_post, .contacts_quote { border: 1px solid "+s.preferences.contactsColor+" !important; border-left: 5px solid "+s.preferences.contactsColor+" !important; } .contacts_post td.alt2 { width: 171px; }");for(var o=document.getElementsByClassName("bigusername"),i=e===n?0:o.length-e,r=i,c=o.length;c>r;r++){var p=o[r].innerHTML,u=o[r].parentNode.parentNode.parentNode.parentNode.parentNode;if(p===d&&p!==t)u.classList.add("op_post");else if(s.preferences.myPosts&&p===t)u.classList.add("my_post");else for(var h=0,f=a.length;f>h;h++)if(p===a[h]){u.classList.add("contacts_post");break}}if(s.preferences.quotes)for(var m=document.getElementsByClassName("alt2"),r=0,c=m.length;c>r;r++){var g=m[r].getElementsByTagName("B");if(g&&g.length>0){var v=g[0].textContent;if(v===d&&v!==t)m[r].classList.add("op_quote");else if(s.preferences.myPosts&&v===t)m[r].classList.add("my_quote");else for(var h=0,f=a.length;f>h;h++)if(v===a[h]){m[r].classList.add("contacts_quote");break}}}if(0===i){var b=document.getElementById("threadtools"),y=b.parentNode,w=document.createElement("TD");w.className="vbmenu_control",w.innerHTML='<a href="/foro/search.php?do=process&searchthreadid='+l+"&searchuser="+escape(d)+'&exactname=1">Buscar posts del OP</a>',y.insertBefore(w,b)}}function r(){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===t.readyState&&200===t.status){for(var n=t.responseText,a=new DOMParser,o=a.parseFromString(n,"text/html"),i=o.getElementById("buddylist").getElementsByTagName("a"),r=[],s=0,l=i.length;l>s;s++)r.push(i[s].textContent);var c=r.join(", "),d=e("input[data-maps-to='contacts']").tokenfield("getTokensList",",");r.length>0?d?c!==d?bootbox.confirm("<p>La lista actual se sobreescribirá con el nuevo listado que se obtenga de tu <a href='/foro/profile.php?do=buddylist' target='_blank'>lista de contactos</a>.</p><p>¿Desea continuar?</p>",function(t){t&&e("input[data-maps-to='contacts']").tokenfield("setTokens",c)}):bootbox.alert("No hemos detectado cambios en tu <a href='/foro/profile.php?do=buddylist' target='_blank'>lista de contactos</a> desde la última importación. Realiza cambios en tus contactos antes de volver a intentarlo."):e("input[data-maps-to='contacts']").tokenfield("setTokens",c):bootbox.alert("Tu <a href='/foro/profile.php?do=buddylist' target='_blank'>lista de contactos</a> está vacía. Para resaltar los mensajes de tus contactos... ¡primero añade algunos!")}},t.open("GET","/foro/profile.php?do=buddylist",!0),t.send()}var s=t({id:"HighlightOP",name:"Resaltar ciertos mensajes de un hilo",author:"Electrosa",version:"1.1",description:"Resalta tus mensajes, los mensajes del creador del hilo y los posts de los usuarios que elijas, para distingirlos mejor mientras navegas por los hilos.",domain:["/showthread.php"],initialPreferences:{enabled:!0,quotes:!0,opPostsColor:"#DC143C",myPosts:!1,myPostsColor:"#1E90FF",contacts:"",contactsColor:"#2FC726"},preferences:{}});s.getPreferenceOptions=function(){var e=s.helper.createPreferenceOption,t=function(){r()};return"function"==typeof exportFunction?exportFunction(t,unsafeWindow,{defineAs:"HighlightOP_importBuddyList"}):unsafeWindow.HighlightOP_importBuddyList=t,[e({type:"checkbox",mapsTo:"quotes",caption:"Resaltar también las citas."}),e({type:"color",mapsTo:"opPostsColor",caption:"Color de resaltado de los posts del creador del hilo"}),e({type:"checkbox",mapsTo:"myPosts",caption:"Resaltar mis propios posts."}),e({type:"color",mapsTo:"myPostsColor",caption:"Color de resaltado de mis posts"}),e({type:"tags",mapsTo:"contacts",caption:"Resaltar los posts de los siguientes usuarios (separados por comas)",buttons:!0,plain:!0,button1:'<a href="#" onclick="HighlightOP_importBuddyList(); return false;" class="btn btn-xs btn-default">Importar de la lista de contactos</a>'}),e({type:"color",mapsTo:"contactsColor",caption:"Color de resaltado de los posts de usuarios conocidos."})]},s.normalStartCheck=function(){return!0};var l,c,d;s.onNormalStart=function(){l=SHURSCRIPT.environment.thread.id,c=SHURSCRIPT.environment.thread.page,1==c?(d=o(document.querySelector("#posts div.page")),sessionStorage["op_"+l]=d,i()):l&&(sessionStorage["op_"+l]?(d=sessionStorage["op_"+l],i()):a(l)),SHURSCRIPT.eventbus.on("newposts",function(e,t){i(t)})}}(jQuery,SHURSCRIPT.moduleManager.createModule),function(e,t,n){"use strict";function a(){if(!g){g=e(y.helper.getResourceText("imageuploaderhtml")),e("body").append(g);var t=e("#imageurl",g),n=e("#imgur_button",g),a=e("#imgur_file",g),r=e("#imgur_url",g);g.on("show.bs.modal",function(){e("input, textarea",this).val(""),n.html("Seleccionar una o m&aacute;s im&aacute;genes...")}),g.on("shown.bs.modal",function(){t.focus()}),t.keypress(function(e){13==e.which&&t.val()&&(m(t.val()),g.modal("hide"))}),n.on("click",function(){a.click()}),a.on("change",function(e){var t=e.originalEvent.target.files.length;n.html(t+" "+(t>1?"im&aacute;genes seleccionadas":"imagen seleccionada"))}),g.on("click","#insert-images",function(){var e;(e=t.val())?m(e):(e=a.val())?e=i(a.get(0).files):(e=r.val())&&(e=o(e)),e&&g.modal("hide")})}g.modal()}function o(t){var n=t.split("\n");return w+=n.length,e.each(n,function(e,t){0==t.indexOf("http")?r(t,"url"):w--}),w&&s(),w}function i(t,n){n&&(n.stopPropagation(),n.preventDefault()),w+=t.length;var a;return e.each(t,function(e,t){t.type.match("image.*")?(a=new FileReader,a.onload=function(e){r(e.target.result)},a.readAsDataURL(t)):w--}),w&&s(),w}function r(t,n){e.ajax({url:"https://api.imgur.com/3/image",method:"POST",headers:{Authorization:"Client-ID "+SHURSCRIPT.config.imgurClientID,Accept:"application/json"},data:{image:t.replace(/^data:image\/.*;base64,/,""),type:n||"base64"}}).done(function(e){m(e.data.link)}).fail(function(e){var n=JSON.parse(e.responseText).data.error,a="Ha ocurrido un error al subir la imagen a Imgur. Detalles: "+(n.message||n);y.helper.showMessageBar({message:a,type:"danger",timeout:5e3}),y.helper.throw("Error Imgur: "+e.responseText+"\nBase64 Image: "+t,e)}).always(function(){x++,l()})}function s(){b||(b=!0,bootbox.dialog({message:'<center>Subiendo im&aacute;genes...<div id="uploadprogress" style="margin-top: 10px;" class="hidden progress progress-striped active"><div class="progress-bar" style="width: 0%"></div></div></center>'})),l()}function l(){w>1&&(e("#uploadprogress").removeClass("hidden"),e("#uploadprogress .progress-bar").css("width",100*x/w+"%"),x&&e("#uploadprogress .progress-bar").text(x+" de "+w)),x==w&&(b=!1,w=x=0,bootbox.hideAll())}function c(){return"/showthread.php"==y.helper.environment.page?unsafeWindow.vB_Editor.vB_Editor_QR:unsafeWindow.vB_Editor.vB_Editor_001}function d(){return 1==c().wysiwyg_mode}function p(){return c().get_editor_contents()}function u(e){f(),c().set_editor_contents(e)}function h(e){f(),c().insert_text(e)}function f(){d()&&c().editdoc.body.focus()}function m(e){if(d()){var t="<br/>";t+="preview"==y.preferences.embedding?'<img src="'+e+'"/>':"[IMG]"+e+"[/IMG]",h(t)}else u(p()+"\n[IMG]"+e+"[/IMG]")}var g,v,b,y=t({id:"ImageUploader",name:"Subir im&aacute;genes a Imgur",author:"xus0",version:"1.0",description:"Sube o arrastra im&aacute;genes desde tu equipo, y autom&aacute;ticamente se subir&aacute;n a Imgur y se postear&aacute;n en el hilo.",domain:["/showthread.php","/newthread.php","/newreply.php","/editpost.php"],initialPreferences:{embedding:"preview"}}),w=0,x=0;
y.onNormalStart=function(){y.helper.addStyle("imageuploadercss");try{e(".imagebutton[id$='_cmd_insertimage']").get(0).onclick=n,e("body").on("click",".imagebutton[id$='_cmd_insertimage']",a)}catch(t){y.helper.throw("Error al cambiar evento del boton 'Insertar imagen'",t)}try{v=e("<div id='dropzone' style='display: none;'>Suelta aqu&iacute; las im&aacute;genes para subirlas a</div>"),e("body").append(v),e("body").on("dragover",function(t){var n=t.originalEvent.dataTransfer.types;-1!=e.inArray("Files",n)&&-1==e.inArray("text/html",n)&&(t.stopPropagation(),t.preventDefault(),v.show(),t.originalEvent.dataTransfer.dropEffect="copy")}),v.on("dragleave dragend drop",function(){v.hide()}),v.on("drop",function(t){i(t.originalEvent.dataTransfer.files,t)&&(g&&g.modal("hide"),e("html").animate({scrollTop:e("#qrform").offset().top+"px"},800))})}catch(t){y.helper.throw("Error al activar eventos de drag and drop",t)}SHURSCRIPT.eventbus.on("editorReady",function(){e(".imagebutton[id$='_cmd_insertimage']").get(0).onclick=n,e(c().editdoc).on("dragover",function(t){e("body").trigger(t)})})},y.getPreferenceOptions=function(){var e=y.helper.createPreferenceOption;return[e({type:"radio",elements:[{value:"preview",caption:"Previsualizarla dentro de la caja de texto"},{value:"bbcode",caption:"Mostrarla simplemente entre etiquetas [IMG][/IMG]"}],caption:"Al insertar la imagen:",mapsTo:"embedding"})]}}(jQuery,SHURSCRIPT.moduleManager.createModule),function(e,t,n){"use strict";function a(){GM_addStyle("#shurscript-newposts {width:100%; margin:0; height: 32px; padding: 0; line-height: 200%;}");var e=document.createElement("div");e.className="shurscript",f=document.createElement("a"),f.id="shurscript-newposts",f.className="btn btn-success",f.style.display="none",e.appendChild(f);var t=document.getElementById("posts");t.parentNode.insertBefore(e,t.nextSibling)}function o(e){if(!e)if(document.hidden){if("off"===p.preferences.hiddenTabPeriodicity)return null;e=+p.preferences.hiddenTabPeriodicity}else e=+p.preferences.activeTabPeriodicity;return v=setTimeout(r,e),b=+new Date+e,v}function i(){var e=!1;return v&&(clearTimeout(v),e=!0),v=null,b=null,e}function r(){if(i(),(30>u||h)&&x){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){var t=e.responseText,n=new DOMParser,a=n.parseFromString(t,"text/html"),r=h;_=a.querySelectorAll("#posts > div[align]"),h=a.getElementsByClassName("pagenav").length?null===a.getElementsByClassName("pagenav")[0].querySelector("a[rel='next']"):!0,x=null!==a.getElementById("qrform"),g=s(m,_);var d=0!==g.new.length,p=h!==r,f=0!==g.edited.length,v=0!==g.deleted.length;if(u===g.deleted.length){var b=a.querySelector(".panelsurround center");b&&"Tema especificado inválido."===b.textContent&&(i(),bootbox.alert("ATENCIÓN: Este tema ha sido eliminado (tema especificado inválido)."),l("Este tema ha sido eliminado. No recargues la página si quieres seguir viéndolo.","#"))}else d||f||v||k?(c(g.new,g.edited,g.deleted),o()):p?l("Hay una nueva página","showthread.php?t="+y+"&page="+(+w+1)):o()}},e.open("GET","/foro/showthread.php?t="+y+"&page="+w,!0),e.send()}}function s(e,t){for(var n={},a={},o=0,i=e.length;i>o;o++){var r=e[o].getElementsByClassName("alt1")[0],s=r.id.substr(8);n[s]={post:r.children[0].children[0],mainNode:e[o]}}for(var o=0,i=t.length;i>o;o++){var r=t[o].getElementsByClassName("alt1")[0],s=r.id.substr(8);a[s]={post:r.children[0].children[0],mainNode:t[o]}}var l=[],c=[],d=[];for(var p in n){var u=a[p];u||d.push(p)}for(var h in a)h in n||l.push({id:h,node:a[h].mainNode});return{"new":l,deleted:d,edited:c}}function l(t,a){t?(a?(f.href=a,f.onclick=n):(f.href="#",f.onclick=d),f.textContent=t,k||(e(f).slideDown(),k=!0)):k&&(e(f).slideUp(),f.textContent="",k=!1)}function c(e,t,n){if(p.preferences.loadAutomatically)d();else{var a=e?e.length:0,o=n?n.length:0,i="";0!==o&&(i+=1===o?"Se ha eliminado un post. ":"Se han eliminado "+o+" posts. "),0!==a&&(i+=1===a?"Hay un post nuevo. ":"Hay "+a+" posts nuevos. "),document.title=T,i?(l(i,!1),"string"!=typeof newPage&&setTimeout(function(){document.title="*"+T},1)):l(!1)}}function d(){f.style.display="none",f.textContent="",k=!1,document.title=T;var t=document.createElement("div");t.className="new-posts",t.style.display="none";for(var n=0,a=g.new.length;a>n;n++){var o=g.new[n],i=o.id;t.appendChild(o.node)}var r=document.getElementById("posts");r.insertBefore(t,document.getElementById("lastpost")),e(t).slideDown();for(var n=0,a=g.new.length;a>n;n++){var s=g.new[n].node;unsafeWindow.PostBit_Init(s,i),unsafeWindow.parseScript(s.innerHTML)}for(var n=0,a=g.deleted.length;a>n;n++){var i=g.deleted[n],s=document.getElementById("edit"+i).parentNode.parentNode.parentNode;e(s).fadeTo("slow",.35),s.removeAttribute("align")}return SHURSCRIPT.eventbus.trigger("newposts",g.new.length),unsafeWindow.ajax_last_post=+new Date/1e3,m=document.querySelectorAll("#posts > div[align], #posts > div > div[align]"),u=m.length,h||l("Hay una nueva página","showthread.php?t="+y+"&page="+(+w+1)),!1}var p=t({id:"ThreadUpdater",name:"Actualiza las nuevas respuestas de un hilo",author:"Electrosa",version:"0.1",description:"Dentro de un hilo, se añadirán nuevas respuestas automáticamente sin necesidad de recargar la página.",domain:["/showthread.php"],initialPreferences:{enabled:!0,activeTabPeriodicity:1e4,hiddenTabPeriodicity:3e4,loadAutomatically:!1,nextPageButton:!1},preferences:{}});p.getPreferenceOptions=function(){var e=p.helper.createPreferenceOption;return[e({type:"radio",elements:[{value:5e3,caption:"Cada 5 segundos."},{value:1e4,caption:"Cada 10 segundos."},{value:3e4,caption:"Cada 30 segundos."}],caption:"Si la pestaña está en primer plano, buscar nuevas respuestas:",mapsTo:"activeTabPeriodicity"}),e({type:"radio",elements:[{value:1e4,caption:"Cada 10 segundos."},{value:3e4,caption:"Cada 30 segundos."},{value:6e4,caption:"Cada minuto."},{value:"off",caption:"No buscar nuevas respuestas.",subCaption:"Al entrar en la pestaña se buscarán nuevas respuestas."}],caption:"Si la pestaña no está en primer plano, buscar nuevas respuestas:",mapsTo:"hiddenTabPeriodicity"}),e({type:"checkbox",mapsTo:"loadAutomatically",caption:"Cargar nuevos posts automáticamente."}),e({type:"checkbox",mapsTo:"nextPageButton",caption:"Mostrar siempre el botón para ir a la siguiente página, no solo cuando haya una nueva."})]};var u,h,f,m,g,v,b,y,w,x=!0,k=!1,_=[],T=document.title;p.normalStartCheck=function(){return!SHURSCRIPT.environment.thread.isClosed},p.onNormalStart=function(){if(m=document.querySelectorAll("#posts > div[align]"),u=m.length,h=document.getElementsByClassName("pagenav").length?null===document.getElementsByClassName("pagenav")[0].querySelector("a[rel='next']"):!0,y=SHURSCRIPT.environment.thread.id,w=SHURSCRIPT.environment.thread.page,30>u||h){o(),a(),document.addEventListener("visibilitychange",function(){var e=b-+new Date,t=i();document.hidden?"off"!==p.preferences.hiddenTabPeriodicity&&t&&o(p.preferences.hiddenTabPeriodicity-p.preferences.activeTabPeriodicity+e):"off"!==p.preferences.hiddenTabPeriodicity&&e>p.preferences.activeTabPeriodicity?t&&o(p.preferences.activeTabPeriodicity-p.preferences.hiddenTabPeriodicity+e):r()}),document.getElementById("qrform").addEventListener("submit",function(){i(),l(!1),document.title=T});var e=unsafeWindow.qr_do_ajax_post,t=function(t){var a;if("number"==typeof t)a=t;else{if("object"!=typeof t)return;if(e(t),"postbits"!==t.responseXML.children[0].nodeName)return r(),n;a=t.responseXML.children[0].children.length-1,SHURSCRIPT.eventbus.trigger("newposts",a)}u+=a,m=document.querySelectorAll("#posts > div[align], #posts > div > div[align]"),30>=u?o():l("Hay una nueva página","showthread.php?t="+y+"&page="+(+w+1))};if("function"==typeof exportFunction){exportFunction(SHURSCRIPT.eventbus.trigger,unsafeWindow,{defineAs:"SHURSCRIPT_triggerEvent"});var s=function(e){window.qr_do_ajax_post_original(e),"postbits"===e.responseXML.children[0].nodeName&&window.SHURSCRIPT_triggerEvent("newposts",e.responseXML.children[0].children.length-1)},c=document.createElement("script");c.type="text/javascript",c.innerHTML="						window.qr_do_ajax_post_original = window.qr_do_ajax_post;						window.qr_do_ajax_post = "+(""+s)+";",document.getElementsByTagName("head")[0].appendChild(c),SHURSCRIPT.eventbus.on("newposts",function(e,n){t(n)})}else unsafeWindow.qr_do_ajax_post=t}else p.preferences.nextPageButton&&(a(),l("Ir a la página siguiente","showthread.php?t="+y+"&page="+(+w+1)))}}(jQuery,SHURSCRIPT.moduleManager.createModule),function(e,t,n){"use strict";function a(){var t;e(C()).keypress(function(e){if(e.which===D.DOM_VK_COLON){var n=l();if(L&&n){var a=N[n+":"];a&&(v(a),e.preventDefault()),r()}else L=!0,e.preventDefault(),R("<icon>:</icon>"),t=setTimeout(h,1e3)}}),e(C()).keydown(function(e){L&&(clearTimeout(t),p(e))}),e("body").click(r),e(T().editdoc).click(r),e(window).on("resize",r)}function o(){A=e('<div id="shurscript-icons-box" style="display: none;" class="popover top in"><div class="arrow"></div></div>'),I=e('<div class="panel-body" tabindex="-1"></div>'),I.on("click",".icon",function(){v(e(this).data("icon"))}),A.append(I),e('<div class="shurscript">').append(A).prependTo(T().controlbar.parentNode);var t="<table><tr><td>Enter</td><td>Insertar</td></tr><tr><td>Shift + Enter</td> <td>Insertar varios</td> </tr><tr><td>Flechas/Tab</td> <td>Seleccionar</td> </tr><tr><td>Esc</td> <td>Cerrar popup</td></tr></table>",n=e('<span id="shurscript-autoicons-tooltip-trigger" data-toggle="tooltip" data-placement="top">?</span>');n.tooltip({title:t,html:!0}),A.append(n)}function i(e){S()?e():SHURSCRIPT.eventbus.on("editorReady",function(){S()&&e()})}function r(){L=!1,A.hide(),I.empty()}function s(){L=!0,A.show();var t=w();if(t){var n=Math.min(e(window).width()-A.outerWidth(),t.absoluteLeft-A.outerWidth()/2+5);n=Math.max(0,n),A.css("marginTop","0"),A.css("top",t.absoluteTop-90+"px"),A.css("left",n+"px"),A.find(".arrow").show(),A.find(".arrow").css("left",t.absoluteLeft-n+5+"px")}else A.css("top","auto"),A.css("left","auto"),A.css("marginTop","-65px"),A.find(".arrow").hide()}function l(){var e=T().editwin.getSelection().anchorNode.nodeValue;return e&&e.toLowerCase().trim()}function c(){var e=A.find(".icon.selected");e.length?(e.removeClass("selected"),e.next().addClass("selected")):I.children().first().addClass("selected")}function d(){var e=A.find(".icon.selected");e.length?(e.removeClass("selected"),e.prev().addClass("selected")):I.children().last().addClass("selected")}function p(e){var t=e.keyCode;if(t===D.DOM_VK_LEFT||t===D.DOM_VK_UP||t===D.DOM_VK_TAB&&e.shiftKey)d(),e.preventDefault();else if(t===D.DOM_VK_RIGHT||t===D.DOM_VK_DOWN||t===D.DOM_VK_TAB)c(),e.preventDefault();else if(t===D.DOM_VK_ESCAPE||t===D.DOM_VK_SPACE)r();else if(t===D.DOM_VK_RETURN){var n=u();n?(v(n),e.shiftKey||r(),e.preventDefault()):r()}else e.shiftKey||setTimeout(function(){var e=l();e?h(e):r()},0)}function u(){return A.find(".icon.selected").data("icon")}function h(e){var t=0;I.html(""),P.some(function(a){return(e===n||":"===e||-1!==a.name.indexOf(e.substr(1)))&&(I.append(f(a)),t++),t>10}),e&&e.length>1&&I.children().first().addClass("selected"),I.children().length?s():A.hide()}function f(t){var n="",a=$[t.name];1==a?n="Usado solo una vez":a>1&&(n="Usado "+a+" veces");var o=e('<span class="icon" title="'+n+'">');o.append('<img border="0" class="inlineimg" src="'+t.src+'" style="cursor: pointer; padding: 5px;">');var i=e('<div class="badge"/>');return i.append('<span class="name">'+t.name+"</div>"),o.data("icon",t),o.append(i),o}function m(t){var n=[],a={};e.ajax({type:"GET",dataType:"text",url:"/foro/misc.php?do=getsmilies&editorid="+T().editorid}).done(function(o){var i=e(o).find("tr[valign]"),r=function(e,t){var n=t.textContent,a=e.children[0],o=a.getAttribute("id").match(/_(\d*)/)[1],i=a.getAttribute("src");return{name:n,id:o,src:i}};i.each(function(e,t){var o=t.children,i=r(o[0],o[1]);n.push(i),a[i.name]=i,o.length>2&&(i=r(o[2],o[3]),n.push(i),a[i.name]=i)}),$=JSON.parse(M.helper.getValue("MOST_USED_ICONS","{}")),n=g(n),t(n,a)})}function g(e){return _.isEmpty($)?e:_.sortBy(e,function(e){var t=$[e.name];return t?-1*t:0})}function v(e){x(),b(e)}function b(e){T().insert_smilie(n,e.name,e.src,e.id),R("&nbsp;"),y(e)}function y(e){var t=$[e.name]||0;$[e.name]=++t,M.helper.setValue("MOST_USED_ICONS",JSON.stringify($)),P=g(P)}function w(){var t=T().editwin.getSelection().anchorNode,n=document.createRange();n.selectNodeContents(t),n.setStart(t,T().editwin.getSelection().getRangeAt(0).startOffset);var a=n.getClientRects()[0];return a&&{left:a.left,top:a.top,absoluteLeft:a.left+e(T().editbox).offset().left,absoluteTop:a.top+e(T().editbox).offset().top}}function x(){var e=T().editwin.getSelection().anchorNode,t=document.createRange();t.selectNodeContents(e);var n=T().editwin.getSelection();n.removeAllRanges(),n.addRange(t)}function k(){var t;E()?(t=e('<fieldset class="fieldset" style="margin:3px 0 0 0"></fieldset>'),e("#"+T().editorid).parent().append(t)):(t=e("#"+T().editorid+"_smiliebox"),t.css("width",t.width())),t.html("<legend>Iconos favoritos</legend>");var n=M.preferences.favouriteIcons;n&&n.trim()||(n=M.initialPreferences.favouriteIcons,M.preferences.favouriteIcons=n,M.storePreferences()),n=n.split(/\ ?,\ ?/),n.forEach(function(n){var a=N[n];if(a){var o=e('<img border="0" title="'+a.name+'" class="icon inlineimg" src="'+a.src+'" style="cursor: pointer; padding: 5px;">');o.click(function(){b(a)}),t.append(o)}});var a=e("<a href='#qrform'>Más...</a>");a.click(function(){T().open_smilie_window(785,500)}),t.append(a)}function T(){return"/showthread.php"==M.helper.environment.page?unsafeWindow.vB_Editor.vB_Editor_QR:unsafeWindow.vB_Editor.vB_Editor_001}function C(){return("/showthread.php"==M.helper.environment.page?e("#vB_Editor_QR_iframe"):e("#vB_Editor_001_iframe")).get(0).contentDocument.body}function S(){try{return C()}catch(e){return!1}}function E(){return"vB_Editor_QR"===T().editorid}function R(e){O(),T().insert_text(e)}function O(){C().focus()}var M=t({id:"AutoIcons",name:"Iconos favoritos y autocompletado",author:"xus0",version:"0.1",description:'Muestra una caja con sugerencias de iconos de Forocoches al escribir ":" en la caja de respuesta.<br>Y define tus iconos favoritos para tenerlos a golpe de click en la respuesta rápida.',domain:["/showthread.php","/newthread.php","/newreply.php","/editpost.php"],initialPreferences:{enabled:!0,addFavouriteIcons:!0,favouriteIcons:":roto2:, :sisi3:, :mola:, :cantarin:, :qmeparto:, :nusenuse:, :facepalm:, :zpalomita, :zplatano2, :number1:, :elrisas:, :gaydude:, :sisi1:, :babeando:, :elboinas:, :qtedoy:, :abrazo:"}});M.getPreferenceOptions=function(){return[M.helper.createPreferenceOption({type:"checkbox",mapsTo:"addFavouriteIcons",caption:"Añadir un listado debajo de la caja de respuesta rápida con los siguientes iconos:"}),M.helper.createPreferenceOption({type:"tags",mapsTo:"favouriteIcons",caption:null,subCaption:"Deja el campo en blanco para usar los iconos por defecto."})]};var A,I,P,N,$,L=!1;if(M.onNormalStart=function(){M.helper.addStyle("autoiconscss"),o(),m(function(e,t){P=e,N=t,i(function(){a()}),M.preferences.addFavouriteIcons&&k()})},D===n)var D={DOM_VK_TAB:9,DOM_VK_RETURN:13,DOM_VK_ESCAPE:27,DOM_VK_SPACE:32,DOM_VK_LEFT:37,DOM_VK_UP:38,DOM_VK_RIGHT:39,DOM_VK_DOWN:40,DOM_VK_COLON:58,DOM_VK_BACK_SPACE:8}}(jQuery,SHURSCRIPT.moduleManager.createModule),function(e,t){"use strict";function n(){return Math.random().toString(36).substring(2)}function a(){var t=e("td.alt2 div a"),n=null;_.each(t,function(t){n||(n=e(t).text()),e(t).text().indexOf(n)>-1&&e(t).attr("href","#").text("*")}),e(".cajascat .cat").first().text("*")}function o(){var t=e("#posts img, #posts iframe, #posts embed");_.each(t,function(t){var a=e(t);if("nofollow"!=a.parent().attr("rel")){var o="hide-img-"+n(),i=e("<a/>").text("Mostrar/Esconder").attr("href","#");a.hide().addClass(o).after(i),i.on("click",function(t){t.preventDefault(),e("."+o).toggle()})}})}var i=t({id:"PrivateMode",name:"Modo privado",author:"CKGrafico",version:"1.0",description:"Si estás en casa o en el trabajo y no quieres que vean algunas cosas de FC podrás ocultarlo sin problema",domain:"ALL"});i.onNormalStart=function(){a(),o()}}(jQuery,SHURSCRIPT.moduleManager.createModule);window.top===window&&(SHURSCRIPT.core.initializeEagerly(),jQuery(document).ready(SHURSCRIPT.core.initialize));